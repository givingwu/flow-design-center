(function(e){function t(t){for(var n,r,s=t[0],l=t[1],c=t[2],u=0,p=[];u<s.length;u++)r=s[u],Object.prototype.hasOwnProperty.call(o,r)&&o[r]&&p.push(o[r][0]),o[r]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);d&&d(t);while(p.length)p.shift()();return a.push.apply(a,c||[]),i()}function i(){for(var e,t=0;t<a.length;t++){for(var i=a[t],n=!0,s=1;s<i.length;s++){var l=i[s];0!==o[l]&&(n=!1)}n&&(a.splice(t--,1),e=r(r.s=i[0]))}return e}var n={},o={app:0},a=[];function r(t){if(n[t])return n[t].exports;var i=n[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=n,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var d=l;a.push([0,"chunk-vendors"]),i()})({0:function(e,t,i){e.exports=i("56d7")},1402:function(e,t,i){},"302a":function(e,t,i){},"3d60":function(e,t,i){"use strict";i("8e62")},"4c2a":function(e,t,i){},"56d7":function(e,t,i){"use strict";i.r(t);var n={};i.r(n),i.d(n,"Platform",(function(){return aa})),i.d(n,"Company",(function(){return ra})),i.d(n,"SubCompany",(function(){return sa})),i.d(n,"Project",(function(){return la})),i.d(n,"ConstructUnit",(function(){return ca})),i.d(n,"Department",(function(){return da})),i.d(n,"Role",(function(){return ua})),i.d(n,"User",(function(){return pa})),i.d(n,"SubCompanyGroup",(function(){return fa})),i.d(n,"ProjectGroup",(function(){return ha})),i.d(n,"ConstructUnitGroup",(function(){return Oa})),i.d(n,"DepartmentGroup",(function(){return Na})),i.d(n,"CompanyDepartmentGroup",(function(){return ba})),i.d(n,"CompanyProjectGroup",(function(){return ma})),i.d(n,"toString",(function(){return ya})),i.d(n,"default",(function(){return va}));i("e260"),i("e6cf"),i("cca6"),i("a79d"),i("2d26");var o=i("2b0e"),a=i("5c96"),r=i.n(a);i("0fae");o["default"].use(r.a);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"app"}},[i("DesignCenter")],1)},l=[],c=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"loading",rawName:"v-loading.lock",value:!e.isReady,expression:"!isReady",modifiers:{lock:!0}}],staticClass:"flow-container"},[i("FlowLayout",{attrs:{fields:e.flowFields,"root-node":e.startNode,"curr-node":e.currNode},on:{"click-node":e.handleClickNode,"update-node":e.handleUpdateNode}}),i("SidePanel",{ref:"panel",attrs:{node:e.currNode,"project-only":!!e.projectSysNo,"join-plan":e.joinPlan,fields:e.flowFields,visible:e.visible},on:{"update:visible":function(t){e.visible=t}}}),e.currNode&&e.conditionVisible?i("ConditionSettings",{attrs:{node:e.currNode,fields:e.conditionFields,"using-condition-fields":e.usingConditionFields,visible:e.conditionVisible},on:{"update:visible":function(t){e.conditionVisible=t}}},[i("template",{slot:"title"},[e._v(" 流转条件设置 "),i("span",{staticStyle:{color:"red"}},[e._v("(表单必填字段可作为审批条件)")])])],2):e._e(),e.isDev?i("el-button",{staticStyle:{position:"fixed",right:"20px",bottom:"20px"},on:{click:function(t){return e.handleSave(!0)}}},[e._v("TO JSON")]):e._e()],1)},d=[],u=(i("99af"),i("4de4"),i("4160"),i("caad"),i("d81d"),i("b0c0"),i("b64b"),i("c760"),i("2532"),i("159b"),i("15fd")),p=i("5530"),f=i("2909"),h=i("53ca"),O=(i("c97c"),i("a15b"),i("a623"),i("7db0"),i("d3b7"),i("ac1f"),i("25f0"),i("5319"),i("498a"),i("d4ec")),N=i("bee2"),b=i("ade3"),m=(i("4ec9"),i("3ca3"),i("ddb0"),new Map),y=function(){function e(){Object(O["a"])(this,e)}return Object(N["a"])(e,null,[{key:"isExist",value:function(e){return m.has(this._getNodeId(e))}},{key:"getNode",value:function(t){if(!e.isExist(this._getNodeId(t)))throw new Error("The node ".concat(this._getNodeId(t)," was not found in NodeManager"));return m.get(this._getNodeId(t))}},{key:"addNode",value:function(e){e instanceof ot&&m.set(e.nodeId,e)}},{key:"removeNode",value:function(t){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.getNode(t);n&&n instanceof ot&&(n.childNode&&i&&e.removeNode(n.childNode,i),m.delete(n.nodeId),n=null)}},{key:"clear",value:function(){m.clear()}},{key:"_getNodeId",value:function(e){var t=e;return e instanceof ot&&(t=e.nodeId),t}}]),e}();Object(b["a"])(y,"updateNode",y.addNode);i("c740"),i("c975"),i("a434"),i("07ac");var v,T,E,_,g,P,I,A,R,S,k,C,j,L,w,D,F,B,x,V,M,U,$,Y,G,q={SPONSOR_NODE:"sponsor",APPROVER_NODE:"approver",CONDITION_BRANCH:"cbs",CONDITION_NODE:"condition",CONDITION_BRANCH_END:"cbe",PARALLEL_BRANCH:"pbs",PARALLEL_NODE:"parallel",PARALLEL_BRANCH_END:"pbe",NOTIFIER_NODE:"notifier",END_NODE:"end"},K=(v={},Object(b["a"])(v,q.SPONSOR_NODE,{title:"发起人",content:"所有人",contentIcon:"el-icon-arrow-right",customTitleStyle:{backgroundColor:"#2172C8"}}),Object(b["a"])(v,q.APPROVER_NODE,{title:"审批人",content:"",placeholder:"请选择审批人",titleIcon:"el-icon-s-check",contentIcon:"el-icon-arrow-right",customTitleStyle:{backgroundColor:"#F49150"},errorState:!1}),Object(b["a"])(v,q.CONDITION_BRANCH,{title:"条件分支",btnText:"添加条件",titleIcon:"el-icon-s-grid"}),Object(b["a"])(v,q.CONDITION_NODE,{title:"条件节点",desc:"优先级",placeholder:"请设置条件",customTitleStyle:{color:"#67C23A",backgroundColor:"rgb(255, 255, 255)"},errorState:!1}),Object(b["a"])(v,q.CONDITION_BRANCH_END,{title:"条件结束"}),Object(b["a"])(v,q.PARALLEL_BRANCH,{title:"并行分支",btnText:"添加并行分支",titleIcon:"el-icon-plus"}),Object(b["a"])(v,q.PARALLEL_NODE,{title:"并行分支",content:"",customTitleStyle:{color:"#F49150",fontSize:"13px",backgroundColor:"rgb(255, 255, 255)"}}),Object(b["a"])(v,q.PARALLEL_BRANCH_END,{title:"并行结束"}),Object(b["a"])(v,q.NOTIFIER_NODE,{title:"抄送人",content:"",placeholder:"请选择抄送人",titleIcon:"el-icon-message-solid",contentIcon:"el-icon-arrow-right",customTitleStyle:{backgroundColor:"#5AAAFF"},errorState:!1}),Object(b["a"])(v,q.END_NODE,{content:"流程结束"}),v),z={OPERATION:"operation",AUDIT:"audit",CC:"cc",START:"start",END:"end",START_EXCLUSIVE_GATEWAY:"start_exclusive_gateway",END_EXCLUSIVE_GATEWAY:"end_exclusive_gateway",START_PARALLEL_GATEWAY:"start_parallel_gateway",END_PARALLEL_GATEWAY:"end_parallel_gateway"},H={POSITION:"position",DEPARTMENT:"department",ASSIGN:"assign",OPTIONAL_PERSONNEL:"optional_personnel",POSITION_LABEL:"position_label",DEPARTMENT_LABEL:"department_label",INITIATOR:"initiator",POSITION_OF_FORM:"position_of_form",DEPARTMENT_OF_FORM:"department_of_form",DEPARTMENT_POSITION_OF_FORM:"department_position_of_form",ORGANIZATION_POSITION_OF_FORM:"organization_position_of_form"},W={ROLE:"role",USER:"user",PROJECT:"project",DEPARTMENT:"department",ORGANIZATION:"company"},J=(T={},Object(b["a"])(T,H.POSITION,"positionList"),Object(b["a"])(T,H.POSITION_LABEL,""),Object(b["a"])(T,H.POSITION_OF_FORM,""),Object(b["a"])(T,H.DEPARTMENT,"departmentList"),Object(b["a"])(T,H.DEPARTMENT_LABEL,""),Object(b["a"])(T,H.DEPARTMENT_OF_FORM,""),Object(b["a"])(T,H.DEPARTMENT_POSITION_OF_FORM,""),Object(b["a"])(T,H.INITIATOR,""),Object(b["a"])(T,H.ASSIGN,"userList"),Object(b["a"])(T,H.OPTIONAL_PERSONNEL,""),W.USER),Z=(E={},Object(b["a"])(E,H.POSITION,W.ROLE),Object(b["a"])(E,H.DEPARTMENT,W.DEPARTMENT),Object(b["a"])(E,H.ASSIGN,W.USER),Object(b["a"])(E,J,W.USER),E),Q={name:"userName",value:"userSysNo",type:W.USER},X=(_={},Object(b["a"])(_,H.POSITION,{name:"positionName",value:"positionSysNo",type:W.ROLE}),Object(b["a"])(_,H.DEPARTMENT,{name:"departmentName",value:"departmentSysNo",type:W.DEPARTMENT}),Object(b["a"])(_,H.ASSIGN,Q),Object(b["a"])(_,J,Q),Object(b["a"])(_,W.ORGANIZATION,{name:"organizationName",value:"organizationSysNo",type:W.ORGANIZATION}),Object(b["a"])(_,H.POSITION_LABEL,{name:"positionLabelName",value:"positionLabelSysNo",parentName:"parentFullName",organizationType:"organizationType",type:H.POSITION_LABEL}),_),ee={USER:"user",DEPT:"dept",DEPARTMENT:"department",PROJECT:"project",COMPANY:"company",JOB:"job"},te=(g={},Object(b["a"])(g,H.POSITION_OF_FORM,ee.JOB),Object(b["a"])(g,H.DEPARTMENT_OF_FORM,ee.DEPARTMENT),Object(b["a"])(g,H.DEPARTMENT_POSITION_OF_FORM,ee.DEPT),Object(b["a"])(g,H.ORGANIZATION_POSITION_OF_FORM,ee.JOB),g),ie=(P={},Object(b["a"])(P,H.POSITION_LABEL,"岗位标签"),Object(b["a"])(P,H.POSITION,"岗位"),Object(b["a"])(P,H.ASSIGN,"指定人员"),Object(b["a"])(P,H.OPTIONAL_PERSONNEL,"发起人自选"),Object(b["a"])(P,H.INITIATOR,"发起人自己"),P),ne=(I={},Object(b["a"])(I,H.INITIATOR,{type:H.INITIATOR}),Object(b["a"])(I,H.ASSIGN,{type:H.ASSIGN,list:[{userName:"",userSysNo:0}]}),Object(b["a"])(I,H.POSITION,{list:[{positionName:"",positionSysNo:0}],type:H.POSITION}),Object(b["a"])(I,H.POSITION_OF_FORM,{formFieldKey:"required",type:H.POSITION_OF_FORM}),Object(b["a"])(I,H.DEPARTMENT,{list:[{departmentName:"",departmentSysNo:0}],type:H.DEPARTMENT}),Object(b["a"])(I,H.DEPARTMENT_OF_FORM,{formFieldKey:"required",type:H.DEPARTMENT_OF_FORM}),Object(b["a"])(I,H.DEPARTMENT_POSITION_OF_FORM,{formFieldKey:"required",type:H.DEPARTMENT_POSITION_OF_FORM}),Object(b["a"])(I,H.ORGANIZATION_POSITION_OF_FORM,{formFieldKey:"required",type:H.ORGANIZATION_POSITION_OF_FORM}),Object(b["a"])(I,H.OPTIONAL_PERSONNEL,{optionalScope:"organization",optionalType:"single",list:[{name:"string",sysNo:0}],type:H.OPTIONAL_PERSONNEL}),Object(b["a"])(I,H.POSITION_LABEL,{list:[{positionLabelName:"string",positionLabelSysNo:0}],type:H.POSITION_LABEL}),I),oe={SELF_DEPARTMENT:"self_department",SELF:"self",UPPER_FIRST:"upper_first",UPPER_SECOND:"upper_second",ORGANIZATION:"organization",BRANCH_ORGANIZATION:"branch_organization"},ae=(A={},Object(b["a"])(A,oe.SELF_DEPARTMENT,"本部门"),Object(b["a"])(A,oe.SELF,"本级"),Object(b["a"])(A,oe.UPPER_FIRST,"上一级"),Object(b["a"])(A,oe.UPPER_SECOND,"上二级"),Object(b["a"])(A,oe.ORGANIZATION,"公司级"),Object(b["a"])(A,oe.BRANCH_ORGANIZATION,"分公司级"),{CANDIDATE:"candidate",COUNTERSIGN:"countersign"}),re=(R={},Object(b["a"])(R,ae.COUNTERSIGN,"会签（须所有审批人同意）"),Object(b["a"])(R,ae.CANDIDATE,"或签（一名审批人同意或拒绝即可）"),R),se={AUTO_COMPLETE:"auto_complete",CANNOT_SUBMIT:"cannot_submit"},le=(S={},Object(b["a"])(S,se.AUTO_COMPLETE,"自动通过"),Object(b["a"])(S,se.CANNOT_SUBMIT,"不允许提交"),{SECOND:"S",MINUTE:"M",HOUR:"H",DAY:"D"}),ce=(k={},Object(b["a"])(k,le.MINUTE,"分"),Object(b["a"])(k,le.HOUR,"时"),Object(b["a"])(k,le.DAY,"天"),C={},Object(b["a"])(C,H.POSITION_LABEL,ie[H.POSITION_LABEL]),Object(b["a"])(C,H.ASSIGN,ie[H.ASSIGN]),Object(b["a"])(C,H.INITIATOR,ie[H.INITIATOR]),C),de={USER:"user",PROJECT:"project",DEPARTMENT:H.DEPARTMENT,COMPANY:"company",JOB:"job",POSITION_LABEL:H.POSITION_LABEL},ue=(j={},Object(b["a"])(j,W.USER,80),Object(b["a"])(j,W.PROJECT,3),Object(b["a"])(j,W.DEPARTMENT,5),Object(b["a"])(j,W.ORGANIZATION,2),Object(b["a"])(j,W.ROLE,70),j),pe=(L={},Object(b["a"])(L,de.USER,W.USER),Object(b["a"])(L,de.PROJECT,W.PROJECT),Object(b["a"])(L,de.DEPARTMENT,W.DEPARTMENT),Object(b["a"])(L,de.COMPANY,W.ORGANIZATION),Object(b["a"])(L,de.JOB,W.ROLE),Object(b["a"])(L,de.POSITION_LABEL,H.POSITION_LABEL),L),fe=(w={},Object(b["a"])(w,pe[de.USER],"成员"),Object(b["a"])(w,pe[de.PROJECT],"项目"),Object(b["a"])(w,pe[de.DEPARTMENT],"部门"),Object(b["a"])(w,pe[de.COMPANY],"公司"),Object(b["a"])(w,pe[de.JOB],"角色"),w),he=Object(p["a"])({STRING:"string",TEXT:"input",TEXTAREA:"textarea",RADIO:"radio",COMBO:"combo",LIST:"system_list",NUMBER:"number",MONEY:"amount",SERIAL:"serial"},de),Oe=(D={},Object(b["a"])(D,de.USER,he.LIST),Object(b["a"])(D,de.PROJECT,he.LIST),Object(b["a"])(D,de.DEPARTMENT,he.LIST),Object(b["a"])(D,de.COMPANY,he.LIST),Object(b["a"])(D,de.JOB,he.LIST),Object(b["a"])(D,de.POSITION_LABEL,he.LIST),D),Ne=Object(p["a"])((F={},Object(b["a"])(F,he.TEXT,"string"),Object(b["a"])(F,he.TEXTAREA,"string"),Object(b["a"])(F,he.RADIO,"radio"),Object(b["a"])(F,he.COMBO,"combo"),Object(b["a"])(F,he.NUMBER,"number"),Object(b["a"])(F,he.MONEY,"number"),F),Oe),be=(B={},Object(b["a"])(B,he.TEXT,"单行文本"),Object(b["a"])(B,he.TEXTAREA,"多行文本"),Object(b["a"])(B,he.RADIO,"单选按钮组"),Object(b["a"])(B,he.COMBO,"单选下拉框"),Object(b["a"])(B,he.NUMBER,"数字"),Object(b["a"])(B,he.MONEY,"金额"),{EQUAL:"equal",NE:"not_equal",LT:"less_than",LTE:"less_than_equal",GT:"greater_than",GTE:"greater_than_equal"}),me=(x={},Object(b["a"])(x,be.EQUAL,"="),Object(b["a"])(x,be.NE,"!="),Object(b["a"])(x,be.LT,"<"),Object(b["a"])(x,be.LTE,"<="),Object(b["a"])(x,be.GT,">"),Object(b["a"])(x,be.GTE,">="),V={},Object(b["a"])(V,be.EQUAL,"等于"),Object(b["a"])(V,be.NE,"不等于"),Object(b["a"])(V,be.LT,"小于"),Object(b["a"])(V,be.LTE,"小于等于"),Object(b["a"])(V,be.GT,"大于"),Object(b["a"])(V,be.GTE,"大于等于"),V),ye={EQUAL:"equal",NE:"not_equal",CONTAINS:"contains",NOT_CONTAINS:"not_contains"},ve=(M={},Object(b["a"])(M,ye.EQUAL,"等于"),Object(b["a"])(M,ye.NE,"不等于"),Object(b["a"])(M,ye.CONTAINS,"包含"),Object(b["a"])(M,ye.NOT_CONTAINS,"不包含"),M),Te={EQUAL_ANY_ONE:"equal_any_one",NE_ANY_ONE:"not_equal_any_one"},Ee=(U={},Object(b["a"])(U,Te.EQUAL_ANY_ONE,"等于任意一个"),Object(b["a"])(U,Te.NE_ANY_ONE,"不等于任意一个"),U),_e=Object(p["a"])(($={},Object(b["a"])($,ye.EQUAL,"等于"),Object(b["a"])($,ye.NE,"不等于"),$),Ee),ge=(Y={},Object(b["a"])(Y,he.STRING,ve),Object(b["a"])(Y,he.NUMBER,me),Object(b["a"])(Y,he.RADIO,_e),Object(b["a"])(Y,he.COMBO,_e),Object(b["a"])(Y,he.LIST,Ee),Y),Pe=(G={},Object(b["a"])(G,q.SPONSOR_NODE,{formFieldList:[]}),Object(b["a"])(G,q.APPROVER_NODE,{opinionSetting:{textOpinionName:"文本意见",textOpinionEnabled:!1,textOpinionRequired:!1,textOpinionTip:"",writeSignatureName:"手写签名",writeSignatureEnabled:!1,writeSignatureRequired:!1,writeSignatureCanUseLast:!1},taskRule:ae.COUNTERSIGN,canTransfer:!1,transfer:{type:J,list:[]},canRollback:!1,participantEmptyRule:se.AUTO_COMPLETE,initiatorAutoComplete:!0,participant:{type:H.POSITION_LABEL,list:[],formFieldKey:""},formFieldList:[]}),Object(b["a"])(G,q.NOTIFIER_NODE,{participant:{type:H.POSITION_LABEL,list:[],formFieldKey:""},formFieldList:[]}),G);i("13d5");function Ie(e){return"object"!==Object(h["a"])(e)||null===e?e:e instanceof Date?new Date(e.getTime()):e instanceof Array?e.reduce((function(e,t,i){return e[i]=Ie(t),e}),[]):e instanceof Object?Object.keys(e).reduce((function(t,i){return t[i]=Ie(e[i]),t}),{}):void 0}function Ae(e){for(var t=0,i=arguments.length<=1?0:arguments.length-1;t<i;t++)for(var n=t+1<1||arguments.length<=t+1?void 0:arguments[t+1],o=Object.keys(n),a=0,r=o.length;a<r;a++){var s=o[a];"object"===Object(h["a"])(s)?e[s]=Ie(n[s]):e[s]=n[s]}return e}var Re=function e(){Object(O["a"])(this,e)};Object(b["a"])(Re,"NODE_MAP",{}),Object(b["a"])(Re,"registerNode",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e||Re.NODE_MAP[e])throw new Error("Type ".concat(e," has been registered before."));Re.NODE_MAP[e]=Object(p["a"])({type:e,model:t},i)})),Object(b["a"])(Re,"createNode",(function(e){e="string"===typeof e?{type:e}:e;var t=Re.NODE_MAP[e.type];if(t)return new ot(Ae({},Ie(t),Object(p["a"])({},e)));throw new ReferenceError("No any type ".concat(e.type," found in Flow.NODE_MAP, have u registered it before?"))})),Object.values(q).forEach((function(e){Re.registerNode(e,K[e],Pe[e])}));var Se,ke="general",Ce="other_condition",je=function(e,t){var i=t.type,n=Object(u["a"])(t,["type"]);if(!e||!(e instanceof ot))throw new TypeError;var o=null;if(He(i))Ye(i)?o=Be(n):Ge(i)&&(o=Ve(n));else{if(We(i)){n=Object(p["a"])({prevId:e.nodeId},n);var a=Fe(e);if(qe(i)){var r=xe(n);Ke(a[a.length-1])?a.splice(a.length-1,0,r):(a.push(r),a.push(xe(Object(p["a"])(Object(p["a"])({},n),{},{conditionType:Ce}))))}else ze(i)&&a.push(Me(n));return e}o=Re.createNode(Object(p["a"])({type:i},n))}return we(e)?De(e,o):e.next(o),e},Le=function(e){return He(e)&&(e=e.childNode),e},we=function(e){return Le(e).childNode},De=function(e,t){var i=we(e);if(e.next(t),i)if(Ye(t)){var n=t.childrenNodes[0];n&&n.next(i)}else Le(t).next(i);return t},Fe=function(e){return e.childrenNodes&&e.childrenNodes.length?e.childrenNodes:[]},Be=function(e){var t=Re.createNode(ot.TYPE.CONDITION_BRANCH),i=[xe(e),xe(Object(p["a"])(Object(p["a"])({},e),{},{conditionType:Ce}))],n=Re.createNode(ot.TYPE.CONDITION_BRANCH_END);return t.next(i),t.next(n),t.oppositeTaskId=n.nodeId,n.oppositeTaskId=t.nodeId,t},xe=function(e){return Re.createNode(Object(p["a"])({type:ot.TYPE.CONDITION_NODE,conditionType:ke},e))},Ve=function(e){var t=Re.createNode(ot.TYPE.PARALLEL_BRANCH),i=[Me(e),Me(e)],n=Re.createNode(ot.TYPE.PARALLEL_BRANCH_END);return t.next(i),t.next(n),t.oppositeTaskId=n.nodeId,n.oppositeTaskId=t.nodeId,t},Me=function(e){return Re.createNode(Object(p["a"])({alias:ot.TYPE.PARALLEL_NODE,type:ot.TYPE.APPROVER_NODE},e))},Ue=function(e){var t=y.getNode(e.prevId);if(We(e.alias||e.type)){var i=Fe(t),n=i.length<=2,o=i.findIndex((function(t){return y.getNode(e).nodeId===t.nodeId}));if(!n)return i.splice(o,1),y.removeNode(e),t;var a=y.getNode(t.prevId),r=1===o?0:1;if(a){y.removeNode(t,!1),i.filter((function(e,t){return t===o})).forEach((function(e){y.removeNode(e,!0)})),y.removeNode(t.childNode,!1);var s=i[r],l=s&&we(s),c=we(t);return l?(y.removeNode(s,!1),a.next(l),c?(l=Xe(l),l.next(c),c):l):(y.removeNode(s,!0),c?a.next(c):a.next(null))}}else{var d=e.childNode;if(t)return y.removeNode(e,!1),d?(Ye(t)&&(t.oppositeTaskId=d.nodeId),t.next(d)):(Ye(t)&&(t.oppositeTaskId=""),t.next(null))}},$e=function(e){if("object"===Object(h["a"])(e)&&e instanceof ot)return e.alias||e.type;if("string"===typeof e)return e;throw new Error("The type of node was invalid value of ".concat(Object(h["a"])(e),": ").concat(e?e.type:e))},Ye=function(e){return $e(e)===ot.TYPE.CONDITION_BRANCH},Ge=function(e){return $e(e)===ot.TYPE.PARALLEL_BRANCH},qe=function(e){return $e(e)===ot.TYPE.CONDITION_NODE},Ke=function(e){return qe(e)&&null===et(e)&&e.conditionType===Ce},ze=function(e){return $e(e)===ot.TYPE.PARALLEL_NODE},He=function(e){return Ye(e)||Ge(e)},We=function(e){return e===ot.TYPE.CONDITION_NODE||e===ot.TYPE.PARALLEL_NODE},Je=function(e){return e===ot.TYPE.CONDITION_BRANCH?ot.TYPE.CONDITION_NODE:e===ot.TYPE.PARALLEL_BRANCH||e===ot.TYPE.PARALLEL_BRANCH_END?ot.TYPE.PARALLEL_NODE:""},Ze=function(e){return[ot.TYPE.SPONSOR_NODE,ot.TYPE.APPROVER_NODE,ot.TYPE.NOTIFIER_NODE,ot.TYPE.PARALLEL_NODE].includes(e)},Qe=function e(t,i){i&&"function"===typeof i&&i(t),t.childrenNodes&&t.childrenNodes.length&&t.childrenNodes.forEach((function(t){e(t,i)})),t.childNode&&e(t.childNode,i)},Xe=function(e){while(e){if(!e.childNode)return e;e=e.childNode}},et=function(e){var t=e.prevId,i=y.getNode(t),n=i.childrenNodes||[],o=n.indexOf(e);return n[o+1]||null},tt="and",it="or",nt=(Se={},Object(b["a"])(Se,tt,"且"),Object(b["a"])(Se,it,"或"),Se),ot=function(){function e(t){var i=t.type,n=void 0===i?"":i,o=t.alias,a=void 0===o?"":o,r=t.nodeId,s=void 0===r?"":r,l=t.prevId,c=void 0===l?"":l,d=t.oppositeTaskId,p=void 0===d?"":d,f=t.childNode,h=void 0===f?null:f,N=t.childrenNodes,b=void 0===N?null:N,m=t.conditionType,v=void 0===m?null:m,T=t.model,E=Object(u["a"])(t,["type","alias","nodeId","prevId","oppositeTaskId","childNode","childrenNodes","conditionType","model"]);Object(O["a"])(this,e),this.type=n,this.nodeId=s||e.getUUID("node",n),this.prevId=c,p&&(this.oppositeTaskId=p),a&&(this.alias=a),h&&(this.childNode=h),b&&(this.childrenNodes=b),v&&(this.conditionType=v),T&&(this.model=Ie(T)),E&&(this.props=Ie(E)),y.addNode(this)}return Object(N["a"])(e,[{key:"isBranchNode",value:function(){return He(this.type)}},{key:"isBranchChildNode",value:function(){return We(this.alias||this.type)}},{key:"next",value:function(e){var t=this;return e&&"object"===Object(h["a"])(e)?Array.isArray(e)?(e.forEach((function(e){return e.prevId=t.nodeId})),o["default"].set(this,"childrenNodes",e),this.childrenNodes=e):(e.prevId=this.nodeId,o["default"].set(this,"childNode",e),this.childNode=e):(o["default"].set(this,"childrenNodes",null),o["default"].set(this,"childNode",null),delete this.childNode),y.updateNode(this),y.updateNode(e),this}},{key:"read",value:function(t){if(void 0===t)return this.model.content||"";if("string"===typeof t)this.update({content:t});else if(this.alias===e.TYPE.APPROVER_NODE||this.type===e.TYPE.APPROVER_NODE||this.type===e.TYPE.NOTIFIER_NODE){var i=t.list;this.update({content:i&&i.length?(i||[]).map((function(e){return"".concat(e.name).concat(e.parentFullName?"("+e.parentFullName+")":"")})).join("，"):""})}else if(this.type===e.TYPE.CONDITION_NODE){var n=t.conditions,o=t.fields,a={},r={},s={};o.forEach((function(e){var t=e.fieldKey,i=e.fieldName,n=e.fieldType,o=e.fieldOptions;a[t]=i,r[t]=n,o&&o.length&&(n===he.COMBO||n===he.RADIO)&&(s[t]=o)}));var l=n.filter((function(e){return e&&e.fieldKey})).map((function(e){var t=e.fieldKey,i=e.conditionCode,n=e.conditionType,o=e.value,r=e.unionLogic,l=e.leftBracket,c=e.rightBracket;if(!t||!n||!o)return"";if(s[t]){var d=s[t],u=(d.find((function(e){return Array.isArray(o)?o.includes(e.value):o===e.value}))||{}).label||"";u&&(o=u)}return[l&&"（",r&&nt[r],a[t],ge[i][n]||"",Array.isArray(o)?o.every((function(e){return"string"===typeof e}))?o.join("、"):o.map((function(e){var t=e.name;return t})).join("、"):o,c&&"）"].filter(Boolean).join("")})).filter((function(e){return e&&e.trim()})).join("，");this.update({content:l})}}},{key:"add",value:function(e){return je(this,e)}},{key:"remove",value:function(){return Ue(this)}},{key:"move",value:function(e,t){if(this.isBranchChildNode()){var i=this.prevId&&y.getNode(this.prevId);if(i){var n=i.childrenNodes;if(n&&n.length&&~e&&~t){var a=n[e],r=n[t];o["default"].set(n,e,r),o["default"].set(n,t,a)}}}}},{key:"getRootNode",value:function(e){while(e.prevId)e=y.getNode(e.prevId);if(!e.prevId)return e}},{key:"update",value:function(){return this.updateModel.apply(this,arguments)}},{key:"updateModel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.model=Object(p["a"])(Object(p["a"])({},this.model),e)}},{key:"updateProps",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.props=Object(p["a"])(Object(p["a"])({},this.props),e)}}],[{key:"getUUID",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"uuid",t=arguments.length>1?arguments[1]:void 0;return"".concat(e).concat(t?"-"+t:"","-xxxx-4xxx-yxxx").replace(/[xy]/g,(function(e){var t=16*Math.random()|0,i="x"===e?t:3&t|8;return i.toString(16)}))}}]),e}();Object(b["a"])(ot,"TYPE",q);var at,rt=i("3835"),st=i("b85c"),lt=function(){function e(){Object(O["a"])(this,e),this.vertices={},this.edges=new Map}return Object(N["a"])(e,[{key:"addVertex",value:function(e){return e&&(this.vertices[e.nodeId]=e),this}},{key:"getVertexKey",value:function(e){return"string"===typeof e?e:e.nodeId}},{key:"getVertexByKey",value:function(e){return this.vertices["string"===typeof e?e:this.getVertexKey(e)]||null}},{key:"removeVertexByKey",value:function(e){var t=this.vertices[e],i=this.edges.get(e);if(i)if(Array.isArray(i))while(i.length){var n=i.pop();this.removeEdge(t,n)}else this.removeEdge(t,i);return t&&delete this.vertices[e],this}},{key:"addEdge",value:function(e,t){var i=this.getVertexByKey(this.getVertexKey(e)),n=this.getVertexByKey(this.getVertexKey(t));i||(this.addVertex(e),i=e),n||(this.addVertex(t),n=t);var o=this.edges.get(i.nodeId);return o?Array.isArray(o)?o.map((function(e){return e.nodeId})).includes(n.nodeId)?console.warn("The ".concat(n.nodeId," has already been added to ").concat(i.nodeId," before")):o.push(n):this.edges.set(i.nodeId,[o,n]):this.edges.set(i.nodeId,n),this}},{key:"removeEdge",value:function(e,t){var i=this.getEdgesByKey(this.getVertexKey(e)),n=this.getVertexByKey(this.getVertexKey(e)),o=this.getVertexByKey(this.getVertexKey(t));if(i)if(Array.isArray(i)){var a=i?i.indexOf(o):-1;~a&&i.splice(a,1)}else o===i&&this.edges.delete(n.nodeId);return this}},{key:"getEdgesByKey",value:function(e){return this.edges.get(e)}},{key:"getAllVertices",value:function(){return Object.values(this.vertices)}},{key:"getAllEdges",value:function(){return Object.values(this.edges)}},{key:"getNeighbors",value:function(e){return this.edges.get(e.nodeId)||[]}},{key:"traverseBFS",value:function(e,t){if(!this.vertices[e.nodeId])return console.warn("Vertex not found");var i=[];i.push(e);var n={};n[e.nodeId]=!0;while(i.length){var o=i.shift(),a=this.getNeighbors(o);o&&t&&t(o,a),a=Array.isArray(a)?a:[a];for(var r=0;r<a.length;r++){var s=a[r];n[s.nodeId]||(n[s.nodeId]=!0,i.push(s))}}}},{key:"traverseDFS",value:function(e,t){if(!this.vertices[e.nodeId])return console.warn("Vertex not found");var i={};ct.call(this,e,i,t)}},{key:"getCycle",value:function(){}},{key:"print",value:function(){console.log("\n");var e,t=Object(st["a"])(this.edges);try{for(t.s();!(e=t.n()).done;){var i=Object(rt["a"])(e.value,2),n=i[0],o=i[1];console.log("".concat(n," -> ").concat(Array.isArray(o)?o.map((function(e){return e.nodeId})).join(" & "):o?o.nodeId:o))}}catch(a){t.e(a)}finally{t.f()}console.log("\n")}}]),e}();function ct(e,t,i){t[e.nodeId]=!0;var n=this.getNeighbors(e);e&&i&&i(e,n),n=Array.isArray(n)?n:[n];for(var o=0;o<n.length;o++){var a=n[o];t[a.nodeId]&&console.log("It was visited as before"),t[a.nodeId]||(t[a.nodeId]=!0,ct.call(this,a,t,i))}}var dt,ut,pt={TENANT_ORGANIZATION:"tenant_organization",UPPER_LEVEL_ORGANIZATION:"upper_level_organization",LOWER_LEVEL_ORGANIZATION:"lower_level_organization",THIS_LEVEL_ORGANIZATION:"this_level_organization",DEPARTMENT:"department",ASSIGN_POSITION_LABEL:"assign_position_label",ASSIGN_POSITION:"assign_position",ASSIGN_USER:"assign_user"},ft=(at={},Object(b["a"])(at,pt.TENANT_ORGANIZATION,0),Object(b["a"])(at,pt.LOWER_LEVEL_ORGANIZATION,1),Object(b["a"])(at,pt.THIS_LEVEL_ORGANIZATION,2),Object(b["a"])(at,pt.UPPER_LEVEL_ORGANIZATION,3),Object(b["a"])(at,pt.DEPARTMENT,4),[{label:"自选单人",value:"single"},{label:"自选多人",value:"multiple"}]),ht=[{label:"全公司",value:pt.TENANT_ORGANIZATION},{label:"当前组织本上级",value:pt.UPPER_LEVEL_ORGANIZATION},{label:"当前组织本下级",value:pt.LOWER_LEVEL_ORGANIZATION},{label:"当前组织本级",value:pt.THIS_LEVEL_ORGANIZATION},{label:"当前部门",value:pt.DEPARTMENT},{label:"指定岗位标签",value:pt.ASSIGN_POSITION_LABEL},{label:"指定岗位",value:pt.ASSIGN_POSITION},{label:"指定成员",value:pt.ASSIGN_USER}],Ot=function(){return new lt},Nt=function e(t,i){if(t.prevId){var n=i.getVertexByKey(t.prevId)||y.getNode(t.prevId);if(n)return n.type===ot.TYPE.CONDITION_NODE?e(n,i):n}return null},bt=function(e,t){return e.type===ot.TYPE.CONDITION_NODE?Nt(e,t):e},mt=function(e){var t;return e&&(t={},Object(b["a"])(t,ot.TYPE.SPONSOR_NODE,z.START),Object(b["a"])(t,ot.TYPE.APPROVER_NODE,z.AUDIT),Object(b["a"])(t,ot.TYPE.CONDITION_BRANCH,z.START_EXCLUSIVE_GATEWAY),Object(b["a"])(t,ot.TYPE.CONDITION_BRANCH_END,z.END_EXCLUSIVE_GATEWAY),Object(b["a"])(t,ot.TYPE.NOTIFIER_NODE,z.CC),Object(b["a"])(t,ot.TYPE.END_NODE,z.END),Object(b["a"])(t,ot.TYPE.PARALLEL_BRANCH,z.START_PARALLEL_GATEWAY),Object(b["a"])(t,ot.TYPE.PARALLEL_BRANCH_END,z.END_PARALLEL_GATEWAY),t)[e]},yt=function(e){var t;return e&&(t={},Object(b["a"])(t,z.START,ot.TYPE.SPONSOR_NODE),Object(b["a"])(t,z.AUDIT,ot.TYPE.APPROVER_NODE),Object(b["a"])(t,z.START_EXCLUSIVE_GATEWAY,ot.TYPE.CONDITION_BRANCH),Object(b["a"])(t,z.END_EXCLUSIVE_GATEWAY,ot.TYPE.CONDITION_BRANCH_END),Object(b["a"])(t,z.CC,ot.TYPE.NOTIFIER_NODE),Object(b["a"])(t,z.END,ot.TYPE.END_NODE),Object(b["a"])(t,z.START_PARALLEL_GATEWAY,ot.TYPE.PARALLEL_BRANCH),Object(b["a"])(t,z.END_PARALLEL_GATEWAY,ot.TYPE.PARALLEL_BRANCH_END),t)[e]},vt=function(e,t){var i="",n=e.type,o=void 0===n?"":n,a=e.formFieldKey,r=void 0===a?"":a,s=X[o],l=te[o];if(s)i=Et(e,s,i);else if(o===H.INITIATOR)i=ie[H.INITIATOR];else if(o===H.OPTIONAL_PERSONNEL)if(Tt(e.optionalScope)){var c=null;switch(e.optionalScope){case pt.ASSIGN_POSITION:c=H.POSITION;break;case pt.ASSIGN_POSITION_LABEL:c=H.POSITION_LABEL;break;case pt.ASSIGN_USER:c=J;break}var d=X[c];i=Et(e,d,i)}else{var u=ht.find((function(t){return t.value===e.optionalScope}))||{};i="".concat(ie[o],"(").concat(u.label,")")}else l&&r&&(i=ie[o]+"："+(t.find((function(e){return e.fieldKey===r}))||{}).fieldName||"");return i},Tt=function(e){return[pt.ASSIGN_USER,pt.ASSIGN_POSITION,pt.ASSIGN_POSITION_LABEL].includes(e)},Et=function(e,t){if(e.list&&e.list.length)return e.list=e.list.map((function(e){return{name:e[t.name],value:e[t.value],parentFullName:t.parentName?e[t.parentName]:null,organizationType:t.organizationType?e[t.organizationType]:null,hasUser:e.hasUser,model:Object(p["a"])(Object(p["a"])({},e),{},{unitType:t.type})}})),(e.list||[]).map((function(e){return"".concat(e.name).concat(e.parentFullName?"("+e.parentFullName+")":"")})).join("，")},_t=(i("8a79"),i("2ca0"),function(e,t,i){return Ze(i)?At(e,t).map((function(e){var t=e.type,n=e.canWrite,o=e.canView,a=e.require,r=Object(u["a"])(e,["type","canWrite","canView","require"]);return Object(p["a"])(Object(p["a"])({},r),{},{type:t,require:a||!1,canView:void 0===o||o,canWrite:void 0!==n?n:It(i)&&Pt(t)})})):[]}),gt=function(e){return function(t){return Ze(t)?e.map((function(e){var i=e.type,n=e.require,o=Object(u["a"])(e,["type","require"]);return Object(p["a"])(Object(p["a"])({},o),{},{type:i,require:n||!1,canView:!0,canWrite:It(t)&&Pt(i)})})):[]}},Pt=function(e){return e!==he.SERIAL},It=function(e){return e===ot.TYPE.SPONSOR_NODE},At=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=Rt(e),n=Rt(t),o=Object.keys(i),a=0,r=o.length;a<r;a++){var s=o[a],l=n[s];l&&(i[s]=Ae({},i[s],l,{require:(i[s]||{}).require}))}return Object.values(i)},Rt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.reduce((function(e,t){return e[t.key||t.fieldKey]=t,e}),{})},St="_start_user_",kt="_start_user_org_",Ct="_start_user_department_",jt="_start_user_post_",Lt="_start_user_project_",wt="_start_user_post_label_",Dt=(dt={},Object(b["a"])(dt,St,"发起人姓名"),Object(b["a"])(dt,kt,"发起人所属公司"),Object(b["a"])(dt,Ct,"发起人所属部门"),Object(b["a"])(dt,wt,"发起人所属岗位标签"),Object(b["a"])(dt,Lt,"发起人所属项目"),dt),Ft=(ut={},Object(b["a"])(ut,St,de.USER),Object(b["a"])(ut,kt,de.COMPANY),Object(b["a"])(ut,Ct,de.DEPARTMENT),Object(b["a"])(ut,jt,de.JOB),Object(b["a"])(ut,Lt,de.PROJECT),Object(b["a"])(ut,wt,de.POSITION_LABEL),ut),Bt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.taskList,i=void 0===t?[]:t,n=e.sequenceList,o=void 0===n?[]:n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=a.flowFields,s=void 0===r?[]:r,l=a.conditionFields,c=void 0===l?[]:l,d=arguments.length>2?arguments[2]:void 0;if(i.length&&o.length){var u=xt({taskList:i,sequenceList:o},{flowFields:s,conditionFields:c},d);return u}return Re.createNode({type:ot.TYPE.SPONSOR_NODE,nodeId:"task-start",formFieldList:s}).next(Re.createNode({type:ot.TYPE.APPROVER_NODE,formFieldList:gt(s)(ot.TYPE.APPROVER_NODE)}))},xt=function(e,t,i){for(var n=e.sequenceList,o=e.taskList,a=t.flowFields,r=t.conditionFields,s=Ot(),l=Ut(o),c=null,d=0;d<n.length;d++){var u=n[d],p=u.type,f=u.sourceTaskId,h=u.targetTaskId,O=u.conditionList,N=Re.createNode(Mt(Ie(l(f)),{flowFields:a})),b=Re.createNode(Mt(Ie(l(h)),{flowFields:a})),m=Array.isArray(O)&&O.length?$t(O,a,i):[];if(N.type===ot.TYPE.CONDITION_BRANCH){var y=xe({conditions:m,conditionType:p});y.read({conditions:m,fields:r}),s.addEdge(N,y),s.addEdge(y,b)}else N.type===ot.TYPE.PARALLEL_BRANCH&&(b.alias=ot.TYPE.PARALLEL_NODE),s.addEdge(N,b);c||(c=N)}return Vt(s),c},Vt=function(e){var t,i={},n=Object(st["a"])(e.edges);try{for(n.s();!(t=n.n()).done;){var o=Object(rt["a"])(t.value,2),a=o[0],r=o[1];if(r&&r.type!==ot.TYPE.PARALLEL_BRANCH_END&&r.type!==ot.TYPE.CONDITION_BRANCH_END&&r.type!==ot.TYPE.END_NODE){var s=e.getVertexByKey(a);if(i[r.nodeId]){console.log("commonNodeMap: ",i);continue}s.next(r),s.oppositeTaskId&&!i[s.oppositeTaskId]&&(s.childNode||(i[s.oppositeTaskId]=s.next(e.getVertexByKey(s.oppositeTaskId))))}}}catch(l){n.e(l)}finally{n.f()}},Mt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.taskNodeId,i=void 0===t?"":t,n=e.taskNodeName,o=void 0===n?"":n,a=e.taskType,r=void 0===a?"":a,s=e.participant,l=void 0===s?{}:s,c=e.transfer,d=e.formFieldList,f=void 0===d?[]:d,h=Object(u["a"])(e,["taskNodeId","taskNodeName","taskType","participant","transfer","formFieldList"]),O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},N=O.flowFields,b=void 0===N?[]:N,m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],y=yt(r),v="";return m&&l&&(v=vt(l,b)),Object(p["a"])({nodeId:i,type:y,model:{title:o,content:v},participant:l,transfer:c,formFieldList:_t(b,f,y)},h)},Ut=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=e.reduce((function(e,t){return e[t.taskNodeId]=t,e}),{});return function(i){return i&&(t[i]?t[i]:t[i]=e.find((function(e){return e&&e.taskNodeId===i})))}};function $t(e,t,i){return e.filter(Boolean).map((function(e){var n=Ft[e.fieldKey];if(!n){var o=t.find((function(t){return t.fieldKey===e.fieldKey}));o?i&&void 0!==o.require&&!o.require&&(e.fieldKey=""):e.fieldKey=""}return e}))}function Yt(e,t){var i=!1;if(e.traverseBFS(t,(function(e){e.type!==ot.TYPE.APPROVER_NODE&&e.type!==ot.TYPE.PARALLEL_BRANCH||(i=!0);var t=ti(e);if(t){var n=K[e.type].title,o=e.model.title,a="节点";throw o&&o.endsWith(a)&&(o=o.replace(a,"")),n===o&&(o+=a),new Error(t.startsWith(o)?t:o+t)}})),!i)throw new Error("流程中缺少审批人节点")}var Gt,qt,Kt,zt,Ht,Wt,Jt,Zt,Qt,Xt,ei,ti=function(e){if(!e.model.title){var t=K[e.type],i=t.title.replace("人","");return"".concat(i,"节点名称不能为空")}switch(e.type){case ot.TYPE.APPROVER_NODE:return ii(e);case ot.TYPE.NOTIFIER_NODE:return ii(e);case ot.TYPE.CONDITION_NODE:return ni(e);default:break}},ii=function(e){if(e.props){var t=e.props.participant,i=ne[t.type],n=i.formFieldKey,o=i.list,a=i.level,r=function(e){return[pt.ASSIGN_POSITION,pt.ASSIGN_POSITION_LABEL,pt.ASSIGN_USER].includes(e)};if(!te[t.type]&&o&&Array.isArray(o))if(t.type===H.OPTIONAL_PERSONNEL){if(r(t.optionalScope)&&(!t.list||!t.list.length)){var s=ht.find((function(e){return e.value===t.optionalScope}));e.model.errorState=s?"".concat(s.label.substring(2),"不可为空！"):"发起人自选配置有误，请检查后重试！"}}else t.list&&t.list.length||(e.model.errorState="".concat(K[e.type].title,"不能为空"));a&&(t.level||(e.model.errorState="请设置等级属性")),n&&(t.formFieldKey||(e.model.errorState=ie[t.type]+"不能为空"))}else e.model.errorState&&(e.model.errorState=!1);return e.model.errorState},ni=function(e){if(e.props){var t=e.props.conditions;if(e.conditionType!==Ce){var i=Array.isArray(t)&&t.length>0,n=i&&0!==t.filter((function(e){return!e.fieldKey})).length;i?n?e.model.errorState="条件节点缺少的条件字段":(oi(t),e.model.errorState&&(e.model.errorState=!1)):e.model.errorState="条件不能为空"}}return e.model.errorState},oi=function(e){var t=[],i=[],n=0,o=0,a=0,r=e.length,s=new Map;if(e.length)do{n=t.length,o=i.length;var l=e[a++];if(l.leftBracket&&(n=t.push(l)),l.rightBracket){if(o=i.push(l),!n)throw Error("无法找到匹配的左括号");var c=t.pop(),d=i.shift();c&&d&&s.set(c,d)}if(!n&&o)throw Error("无法找到匹配的左括号");if(n>o&&a===r)throw Error("无法找到匹配的右括号")}while(a<r)},ai=function(e,t){var i=Ot(),n=[],o=[],a=ri(i,n),r=si(i,o);if(a(e),r(e),!t){if(!(e&&o.length>1))throw new Error("尚未添加任何流程节点");Yt(i,e)}return{taskList:n.concat(li(ui)),sequenceList:o}},ri=function(e,t){var i=[],n=function n(o){if(o.type!==ot.TYPE.CONDITION_NODE&&t.push(li(o)),o.type!==ot.TYPE.END_NODE){if(e.addVertex(o).addVertex(o.childNode),o.childrenNodes&&o.childrenNodes.length){var a=!1;o.childNode&&(i.push(o.childNode),a=!0),o.childrenNodes.forEach((function(t){e.addEdge(o,t),n(t)})),a&&i.pop()}o.childNode&&(o.childrenNodes&&o.childrenNodes.length||e.addEdge(o,o.childNode),n(o.childNode)),o.childrenNodes||o.childNode||e.addEdge(o,i[i.length-1]||ui)}};return n},si=function(e,t){var i=ci(t),n=function(t){e.traverseBFS(t,(function(t,n){if(t.type!==ot.TYPE.CONDITION_BRANCH){if(t.type===ot.TYPE.CONDITION_NODE){var o=Nt(t,e),a=bt(n,e);if(o&&a)return i({type:t.conditionType,sourceTaskId:o.nodeId,targetTaskId:a.nodeId,conditionList:(t.props.conditions||[]).filter((function(e){return e&&e.fieldKey})).map((function(e){e.key;var t=Object(u["a"])(e,["key"]);return Object(p["a"])({},t)}))})}n&&t.type!==ot.TYPE.END_NODE&&(Array.isArray(n)&&n.length?n.forEach((function(e){i({sourceTaskId:t.nodeId,targetTaskId:e.nodeId})})):i({sourceTaskId:t.nodeId,targetTaskId:n.nodeId}))}}))};return n},li=function(e){var t={taskNodeId:e.nodeId,taskNodeName:(e.model||{}).title,taskNodeDescription:null,taskType:mt(e.type)};e.oppositeTaskId&&(t.oppositeTaskId=e.oppositeTaskId);var i=e.props,n=i.formFieldList,o=void 0===n?[]:n,a=i.participant,r=void 0===a?{}:a,s=(i.buttonList,i.opinionSetting),l=i.transfer,c=Object(u["a"])(i,["formFieldList","participant","buttonList","opinionSetting","transfer"]);if(e.type!==ot.TYPE.END_NODE&&o&&o.length&&(t.formFieldList=o.map((function(e){e.type;var t=Object(u["a"])(e,["type"]);return Object(p["a"])({},t)}))),e.type===ot.TYPE.SPONSOR_NODE);else if(e.type===ot.TYPE.NOTIFIER_NODE||e.type===ot.TYPE.APPROVER_NODE){var d=r.list,f=void 0===d?[]:d,h=r.formFieldKey,O=void 0===h?"":h,N=Object(u["a"])(r,["list","formFieldKey"]);if(O?t.participant=Object(p["a"])({formFieldKey:O},N):f&&f.length?t.participant=Object(p["a"])({list:f.map((function(e){var t=e.model,i=(t.unitType,Object(u["a"])(t,["unitType"])),n=e.hasUser;return Object(p["a"])(Object(p["a"])({},i),{},{hasUser:n})}))},N):t.participant=Object(p["a"])({},N),e.type===ot.TYPE.APPROVER_NODE&&(t.buttonList=[]||!1,t.opinionSetting=Object(p["a"])({},s),l&&l.list&&l.list.length)){var b=l.type,m=l.list;t.transfer={type:b,list:m.map((function(e){var t=e.model,i=(t.unitType,Object(u["a"])(t,["unitType"]));return Object(p["a"])({},i)}))}}t=Object(p["a"])(Object(p["a"])({},t),c)}else if(e.type===ot.TYPE.CONDITION_BRANCH)return t;return t},ci=function(e){var t=[];return function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!i.sourceTaskId||!i.targetTaskId)throw new Error("One of the 'opts.sourceTaskId' || 'opts.targetTaskId' is an invalid value ".concat(JSON.stringify(i)));if(i.sourceTaskId===i.targetTaskId)throw new Error("Are you sure the sourceTaskId and targetTaskId are same?");var n=[i.sourceTaskId,i.targetTaskId].join("->");t.includes(n)?console.log("duplicate key ".concat(n," has been cached")):t.push(n),e.push(Object(p["a"])({id:ot.getUUID("task"),name:null,conditionList:[]},i))}},di={taskNodeId:"task-end",taskNodeName:"结束",taskType:ot.TYPE.END_NODE},ui=Re.createNode({type:ot.TYPE.END_NODE,nodeId:di.taskNodeId,model:{title:di.taskNodeName}}),pi=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-drawer",e._g(e._b({staticClass:"yz design-center-panel-drawer",attrs:{modal:"","append-to-body":""}},"el-drawer",e.$attrs,!1),e.$listeners),[e.node?[i("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[i("el-tab-pane",{attrs:{label:"节点属性",name:"node"}},[e.computedNode?i(e.computedNode,e._g(e._b({tag:"component",staticClass:"flow-panel",attrs:{node:e.node,fields:e.fields}},"component",e.$attrs,!1),e.$listeners)):e._e()],1),e.showPermissionPanel?i("el-tab-pane",{attrs:{label:"表单字段权限",name:"flow"}},[e.needPermissionTable?i("PanelBlock",[i("PanelPermissionTable",e._b({},"PanelPermissionTable",{node:e.node,fields:e.fields,joinPlan:e.joinPlan,canCallbackFormData:!!(e.getFlowFormInfo||{}).canCallbackFormData,flowType:(e.getFlowBaseInfo||{}).flowType},!1))],1):e._e()],1):e._e()],1)]:e._e()],2)},fi=[],hi=(i("e4c4"),i("84d4")),Oi=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"flow-panel-block"},[e.title||e.$slots.title?i("div",{staticClass:"flow-panel-hd"},[e.$slots.title?e._t("title"):i("h4",[e._v(e._s(e.title))])],2):e._e(),i("div",{staticClass:"flow-panel-bd"},[e._t("default")],2)])},Ni=[],bi={name:"PanelBlock",props:{title:{type:String,default:""}}},mi=bi,yi=i("2877"),vi=Object(yi["a"])(mi,Oi,Ni,!1,null,null,null),Ti=vi.exports,Ei=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Table",{staticStyle:{width:"100%"},attrs:{size:"mini",data:e.formFieldList,options:e.options}})},_i=[],gi=(i("45fc"),1),Pi=2,Ii={name:"PanelPermissionTable",props:{node:hi["a"].instanceOf(ot).required,fields:hi["a"].arrayOf(hi["a"].shape({type:hi["a"].string.def(""),fieldKey:hi["a"].string.isRequired,fieldName:hi["a"].string.isRequired,canView:hi["a"].bool.isRequired,canWrite:hi["a"].bool.isRequired,require:hi["a"].oneOf([!0,!1,void 0]).isRequired,editable:hi["a"].bool.isRequired,textVisible:hi["a"].bool.isRequired,useCondition:hi["a"].bool.isRequired})),joinPlan:hi["a"].oneOf([1,2,3]).isRequired,canCallbackFormData:hi["a"].bool.def(!0),flowType:hi["a"].number.def(1)},data:function(){var e=this,t=this.$createElement,i=this.node.props&&this.node.props.formFieldList.filter((function(e){return!e.textVisible})),n=this.node.props&&this.node.props.formFieldList.filter((function(e){return e.textVisible})),o=this.node.type===ot.TYPE.NOTIFIER_NODE,a=this.node.type===ot.TYPE.SPONSOR_NODE,r=!(!this.fields||!this.fields.length),s=n.some((function(e){return e.editable})),l=s&&!o&&(a||this.canCallbackFormData||this.flowType===Pi),c={options:[],formFieldList:[],notViewFormFieldList:[]};return c.options=[{label:"名称",prop:"fieldName",renderHeader:function(){return t("span",{class:"field-name"},["名称"])},render:function(e){var i=e.row,n="field-name";return n+=i.require?" is-required":"",t("div",{class:n},[i.fieldName])}},{label:"可见",width:48,renderHeader:function(){return t("span",["可见"])}},{label:"",prop:"canView",width:34,renderHeader:function(){return r&&t("el-checkbox",{style:"margin-left: -10px;",attrs:{value:e.chosenAllCanView},on:{input:function(t){e.formFieldList.forEach((function(e){return e.canView=t})),t||e.formFieldList.forEach((function(e){return e.canWrite=t}))}}})},render:function(i){var n=i.row,o=i.column,a=i.index;return t("el-checkbox",{style:"margin-left: -10px;",attrs:{value:n[o.prop]},on:{input:function(t){if(n[o.prop]=t,!t){var i=e.formFieldList[a];i&&i.canWrite&&(i.canWrite=!1)}}}})}},l&&{label:"可编辑",width:92,renderHeader:function(){return t("span",{style:"margin-left: 30px"},["可编辑"])}},l&&{label:"",prop:"canWrite",width:24,renderHeader:function(){return r&&t("el-checkbox",{style:"margin-left: -10px;",attrs:{disabled:!e.chosenAllCanView,value:e.chosenAllCanView&&e.chosenAllCanEdit},on:{input:function(t){e.canWriteFields.forEach((function(e){return e.canWrite=t}))}}})},render:function(i){var n=i.row,o=i.column;return!e.checkUsingCondition(n)&&n.editable&&t("el-checkbox",{style:"margin-left: -10px;",attrs:{disabled:!n.canView,value:n[o.prop]},on:{input:function(e){n[o.prop]=e}}})}}].filter(Boolean),i&&i.length&&(c.notViewFormFieldList=i),n&&n.length?c.formFieldList=n:c.formFieldList=this.fields.map((function(t){return Object(p["a"])(Object(p["a"])({},t),{},{canView:1===e.joinPlan||t.textVisible,canWrite:1===e.joinPlan&&!o})}))||[],o&&(c.formFieldList=c.formFieldList.map((function(e){return e.canWrite&&(e.canWrite=!1),e}))),c},computed:{canWriteFields:function(){var e=this;return this.formFieldList.filter((function(t){return t.textVisible&&t.editable&&!e.checkUsingCondition(t)}))},chosenAllCanView:function(){return this.formFieldList.every((function(e){return e.canView}))},chosenAllCanEdit:function(){return this.canWriteFields.every((function(e){return e.canWrite}))}},watch:{formFieldList:{deep:!0,immediate:!0,handler:function(){this.updateFieldList()}}},methods:{updateFieldList:function(){this.node&&this.node.updateProps({formFieldList:this.formFieldList.concat(this.notViewFormFieldList)})},checkUsingCondition:function(e){var t=this.fields.find((function(t){return t.fieldKey===e.fieldKey})),i=this.node.type===ot.TYPE.SPONSOR_NODE;return!(i||!t||!t.useCondition)&&(e.canWrite=!1,!i&&t.useCondition)}}},Ai=Ii,Ri=Object(yi["a"])(Ai,Ei,_i,!1,null,null,null),Si=Ri.exports,ki=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("PanelBlock",{attrs:{title:"发起人节点名称"}},[i("el-input",{attrs:{size:"mini"},on:{change:e.handleChange},model:{value:e.node.model.title,callback:function(t){e.$set(e.node.model,"title",t)},expression:"node.model.title"}})],1),e._t("table")],2)},Ci=[],ji={name:"SponsorPanel",type:q.SPONSOR_NODE,components:{PanelBlock:Ti},props:{node:hi["a"].instanceOf(ot).required},methods:{handleChange:function(e){this.node.update({title:e})}}},Li=ji,wi=Object(yi["a"])(Li,ki,Ci,!1,null,null,null),Di=wi.exports,Fi=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("PanelBlock",{attrs:{title:"审批人节点名称"}},[i("el-input",{attrs:{size:"mini"},on:{change:e.handleChange},model:{value:e.node.model.title,callback:function(t){e.$set(e.node.model,"title",t)},expression:"node.model.title"}})],1),i("PanelBlock",{attrs:{title:"审批人设置"}},[i("el-select",{staticClass:"flow-panel-radios",attrs:{placeholder:"请选择"},model:{value:e.participant.type,callback:function(t){e.$set(e.participant,"type",t)},expression:"participant.type"}},e._l(e.participantTypesOpts,(function(t){return i("el-option",e._b({key:t.value},"el-option",t,!1))})),1),e.showAddBtn?i("div",{staticClass:"flow-panel-button"},[i("el-button",{attrs:{size:"mini",icon:"el-icon-plus",type:"primary"},on:{click:e.handleAddPeople}},[e._v("添加"+e._s(e.participantTypes[e.participant.type]))]),e.showClearBtn?i("el-button",{attrs:{size:"mini",type:"text"},on:{click:e.handleClearTags}},[e._v("清空")]):e._e()],1):e._e(),e.showSelect?[e.selectOptions.length?i("div",{staticClass:"flow-panel-button"},[i("el-select",{attrs:{size:"mini"},model:{value:e.participant.formFieldKey,callback:function(t){e.$set(e.participant,"formFieldKey",t)},expression:"participant.formFieldKey"}},e._l(e.selectOptions,(function(e){var t=e.label,n=e.value;return i("el-option",{key:n,attrs:{label:t,value:n}})})),1)],1):i("div",{staticClass:"flow-panel-button"},[e._v("暂无数据")])]:e._e(),e.showPositionLabelSelection?[i("el-radio-group",{model:{value:e.participant.scope,callback:function(t){e.$set(e.participant,"scope",t)},expression:"participant.scope"}},e._l(e.approveOrderEnum,(function(t,n){return i("el-radio",{key:n,attrs:{title:t,label:n}},[n===e.APPROVE_ORDER_TYPE.PRIORITY?[i("span",[e._v(e._s(t))]),i("el-tooltip",{attrs:{placement:"top-end"}},[i("div",{attrs:{slot:"content"},slot:"content"},[i("p",[e._v(" 按以下岗位标签拖动排序：若找到排序最高的岗位标签有对应审批人，"),i("br"),e._v(" 则提交给该人员审批；若找不到则自动依次往下查找。"),i("br")]),i("br"),i("p",[e._v(" 如审批岗位标签：第1优先级是【副经理】，第2优先级是【经理】。 ")]),i("br"),i("ul",[i("li",[e._v("A分公司有副经理，则直接提交给副经理审批。")]),i("li",[e._v("B分公司没有副经理，则提交给经理审批。")])])]),i("i",{staticClass:"el-icon-info"})])]:[e._v(e._s(t))]],2)})),1)]:e._e(),e.showAddBtn&&e.participant.list&&e.participant.list.length?i("div",{staticClass:"participant"},[i("Draggable",{attrs:{disabled:!e.isDraggable,"ghost-class":"wf-approver-ghost-item"},model:{value:e.participant.list,callback:function(t){e.$set(e.participant,"list",t)},expression:"participant.list"}},[e._l(e.participant.list,(function(t){return[!1===t.hasUser?i("el-popover",{key:t.key,attrs:{"popper-class":"flow-panel-popover",trigger:"hover","visible-arrow":!1,content:"该"+e.participantTypes[e.participant.type]+"中无用户存在",placement:"top"}},[i("span",{staticClass:"participant-item",class:e.isDraggable?"draggable":"",attrs:{slot:"reference"},slot:"reference"},[e.isDraggable?i("i",{staticClass:"el-icon-rank"}):e._e(),i("el-tag",{key:t.value,attrs:{type:"danger",size:"mini","disable-transitions":"",closable:""},on:{close:function(i){return e.handleDeleteTag(e.participant.list,t)}}},[i("span",[e._v(e._s(t.name)+" "+e._s(t.parentFullName||""))]),i("i",{staticClass:"el-icon-warning"})])],1)]):i("span",{key:t.key,staticClass:"participant-item",class:e.isDraggable?"draggable":""},[e.isDraggable?i("i",{staticClass:"el-icon-rank"}):e._e(),i("el-tag",{key:t.value,attrs:{size:"mini","disable-transitions":"",closable:""},on:{close:function(i){return e.handleDeleteTag(e.participant.list,t)}}},[i("span",[e._v(e._s(t.name)+" "+e._s(t.parentFullName||""))])])],1)]}))],2),!e.showAddBtn&&e.showClearBtn?i("el-button",{attrs:{size:"mini",type:"text"},on:{click:e.handleClearTags}},[e._v("清空")]):e._e()],1):e._e(),e.isOptionalPersonal?i("div",[i("div",{staticClass:"personal-block"},[i("el-select",{attrs:{placeholder:"请选择"},model:{value:e.participant.optionalType,callback:function(t){e.$set(e.participant,"optionalType",t)},expression:"participant.optionalType"}},e._l(e.optionalTypes,(function(t){return i("el-option",e._b({key:t.value},"el-option",t,!1))})),1)],1),i("div",{staticClass:"personal-block"},[i("p",[e._v("自选范围")]),i("el-select",{attrs:{placeholder:"请选择"},on:{change:e.handleClearTags},model:{value:e.participant.optionalScope,callback:function(t){e.$set(e.participant,"optionalScope",t)},expression:"participant.optionalScope"}},e._l(e.optionalScope,(function(t){return i("el-option",e._b({key:t.value},"el-option",t,!1))})),1),e.generateBtnName()?i("el-button",{attrs:{type:"primary"},on:{click:e.handleOptional}},[e._v(e._s(e.generateBtnName()))]):e._e(),i("div",{staticClass:"participant"},[e._l(e.participant.list,(function(t,n){return[i("el-tag",{key:t.value,staticClass:"participant-item",attrs:{size:"mini",closable:""},on:{close:function(t){return e.handleScopeClose(n)}}},[e._v(e._s(t.name)+e._s(t.parentFullName&&" "+t.parentFullName))])]}))],2)],1)]):e._e()],2),!e.isOptionalPersonal||e.isOptionalPersonal&&"multiple"===e.participant.optionalType?[i("el-divider"),i("PanelBlock",{attrs:{title:"多人审批时采用方式"}},[i("div",{staticClass:"flow-panel-radios"},[i("el-radio-group",{model:{value:e.taskRule,callback:function(t){e.taskRule=t},expression:"taskRule"}},e._l(e.taskRuleTypes,(function(t,n){return i("el-radio",{key:n,attrs:{label:n}},[e._v(e._s(t))])})),1)],1)])]:e._e(),i("el-divider"),i("PanelBlock",{attrs:{title:"自动通过设置"}},[i("div",{staticClass:"flow-panel-radios"},[i("el-checkbox",{model:{value:e.initiatorAutoComplete,callback:function(t){e.initiatorAutoComplete=t},expression:"initiatorAutoComplete"}},[e._v(" 审批人 = 发起人时，自动通过 "),i("el-tooltip",{attrs:{content:"取消勾选，则审批人=发起人时，依然需要审批",placement:"top"}},[i("i",{staticClass:"el-icon-info"})])],1),i("el-checkbox",{model:{value:e.participantEmptyRule,callback:function(t){e.participantEmptyRule=t},expression:"participantEmptyRule"}},[e._v(" 审批人为空时，自动通过 "),i("el-tooltip",{attrs:{content:"取消勾选，则审批人为空时，不允许提交",placement:"top"}},[i("i",{staticClass:"el-icon-info"})])],1)],1)]),i("PanelBlock",[i("h4",{attrs:{slot:"title"},slot:"title"},[i("span",[e._v("审批意见")]),e._e()]),i("div",{staticClass:"flow-panel-checkbox"},[i("el-checkbox",{model:{value:e.opinionSetting.textOpinionEnabled,callback:function(t){e.$set(e.opinionSetting,"textOpinionEnabled",t)},expression:"opinionSetting.textOpinionEnabled"}},[e._v(e._s(e.opinionSetting.textOpinionName))]),i("el-collapse-transition",[e.opinionSetting.textOpinionEnabled?i("div",{staticClass:"flow-panel-checkbox-gap"},[i("el-checkbox",{model:{value:e.opinionSetting.textOpinionRequired,callback:function(t){e.$set(e.opinionSetting,"textOpinionRequired",t)},expression:"opinionSetting.textOpinionRequired"}},[e._v("必填")])],1):e._e()]),i("p",{staticStyle:{color:"black","font-size":"14px","font-weight":"normal",margin:"10px 0"}},[e._v(" 审批意见提示文字 ")]),i("el-input",{attrs:{size:"mini"},model:{value:e.opinionSetting.textOpinionTip,callback:function(t){e.$set(e.opinionSetting,"textOpinionTip",t)},expression:"opinionSetting.textOpinionTip"}})],1)]),i("PanelBlock",[i("h4",{attrs:{slot:"title"},slot:"title"},[i("span",[e._v("手写签名")]),e._e()]),i("div",{staticClass:"flow-panel-checkbox"},[i("el-checkbox",{model:{value:e.opinionSetting.writeSignatureEnabled,callback:function(t){e.$set(e.opinionSetting,"writeSignatureEnabled",t)},expression:"opinionSetting.writeSignatureEnabled"}},[e._v("审批时需要签名")]),i("el-collapse-transition",[e.opinionSetting.writeSignatureEnabled?i("div",{staticClass:"flow-panel-checkbox-gap"},[i("div",[i("el-checkbox",{model:{value:e.opinionSetting.writeSignatureCanUseLast,callback:function(t){e.$set(e.opinionSetting,"writeSignatureCanUseLast",t)},expression:"opinionSetting.writeSignatureCanUseLast"}},[e._v("允许使用上次签名")])],1)]):e._e()])],1)]),i("el-divider"),i("PanelBlock",[i("h4",{attrs:{slot:"title"},slot:"title"},[i("span",[e._v("其他操作")]),e._e()]),i("div",{staticClass:"flow-panel-checkbox"},[i("el-checkbox",{model:{value:e.canTransfer,callback:function(t){e.canTransfer=t},expression:"canTransfer"}},[e._v("允许转交")]),i("br"),i("el-checkbox",{model:{value:e.canRollback,callback:function(t){e.canRollback=t},expression:"canRollback"}},[e._v("允许回退")]),i("el-collapse-transition",[e.canRollback?i("div",{staticClass:"flow-panel-checkbox-gap"},[i("el-checkbox",{model:{value:e.isDirectRollback,callback:function(t){e.isDirectRollback=t},expression:"isDirectRollback"}},[e._v(" 重新提交时，直接给回退节点 "),i("el-tooltip",{attrs:{content:"被回退人重新修改后，直接提交给回退节点审批",placement:"top"}},[i("i",{staticClass:"el-icon-question"})])],1)],1):e._e()])],1)]),i("SubmitPicker",e._b({attrs:{show:e.pickerVisible,type:e.pickerType,"participant-type":e.participant.type,"default-selected":e.computedParticipantsList},on:{"update:show":function(t){e.pickerVisible=t},confirm:e.handleConfirmPicker}},"SubmitPicker",e.$attrs,!1)),i("PositionPicker",{attrs:{show:e.stationVisible,"role-list":e.computedParticipantsList,"list-key-name":"parentFullName",title:"选择岗位标签",multiple:""},on:{"update:show":function(t){e.stationVisible=t},addCallBack:e.handleCallBack}})],2)},Bi=[],xi=i("ca9f"),Vi=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("SubmitterPicker",e._g(e._b({attrs:{multiple:"",title:e.computedTitle,modal:!1,"append-to-body":!0,"modal-append-to-body":!1,"select-lock":e.type},on:{onConfirm:e.handlePickerConfirm}},"SubmitterPicker",e.$attrs,!1),e.$listeners))},Mi=[],Ui={name:"BaseSubmitPicker",components:{SubmitterPicker:function(){return xi["a"].Lazy("auth2.components.SubmitterPicker")}},inheritAttrs:!1,props:{participantType:hi["a"].oneOf(Object.values(H).concat(J)),type:hi["a"].oneOf(Object.values(W)).def(W.ROLE)},computed:{computedTitle:function(){return"选择"+(ie[this.participantType]||"转交候选人")}},methods:{handlePickerConfirm:function(e){var t=this,i=this.participantType,n=e.map((function(e){var n,o,a,r=e.nodeName,s=e.sysNo,l=i===H.OPTIONAL_PERSONNEL?{}:X[i],c=l.name,d=l.value,u=l.type;switch(i){case J:return{name:r,value:s,hasUser:!0,model:(n={},Object(b["a"])(n,c,r),Object(b["a"])(n,d,s),Object(b["a"])(n,"unitType",u),n)};case H.POSITION:return{name:r,value:s,hasUser:void 0,model:(o={},Object(b["a"])(o,c,r),Object(b["a"])(o,d,s),Object(b["a"])(o,"unitType",u),o)};case H.ASSIGN:return{name:r,value:s,hasUser:void 0,model:(a={},Object(b["a"])(a,c,r),Object(b["a"])(a,d,s),Object(b["a"])(a,"unitType",u),a)};case H.DEPARTMENT:return{name:r,value:s,hasUser:void 0,model:{departmentName:r,departmentSysNo:s,unitType:t.type}};default:return{name:r,sysNo:s,model:{name:r,sysNo:r,unitType:t.type}}}}));this.$emit("update:show",!1),this.$emit("confirm",n)}}},$i=Ui,Yi=Object(yi["a"])($i,Vi,Mi,!1,null,null,null),Gi=Yi.exports,qi={SEQUENCE:"sequence",BACK_TRACKED:"backtracked"},Ki=i("bc3a"),zi=i.n(Ki),Hi="/api/wf/participant/existsUser",Wi=function(e){return zi.a.post(Hi,e)},Ji=function(e){var t=e.list,i=e.type;if((i===H.POSITION||i===H.DEPARTMENT)&&t&&t.length&&!t.every((function(e){return void 0!==e.hasUser&&e.hasUser})))return Wi({participantType:i,sysNoList:t.map((function(e){return e.value}))}).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=e.reduce((function(e,t){var i=t.sysNo,n=t.existsUser;return e[i]=n,e}),{});t.forEach((function(e){e.hasUser=i[e.value]}))}))},Zi=(i("4fad"),function(e){return Object.entries(e).reduce((function(e,t){var i=Object(rt["a"])(t,2),n=i[0],o=i[1];return e.concat({label:o,value:isNaN(+n)?n:+n})}),[])}),Qi=i("b76a"),Xi=i.n(Qi),en="all",tn="priority",nn={ALL:en,PRIORITY:tn},on=(Gt={},Object(b["a"])(Gt,en,"全部审批"),Object(b["a"])(Gt,tn,"按优先级审批"),Gt),an=function(e){return e.map((function(e){var t=e.fieldKey,i=e.fieldName;return{value:t,label:i}}))},rn={name:"ApproverPanel",type:q.APPROVER_NODE,components:{Draggable:Xi.a,PanelBlock:Ti,SubmitPicker:Gi,PositionPicker:function(){return xi["a"].Lazy("auth2.components.PositionPicker")}},props:{node:hi["a"].instanceOf(ot).required,fields:hi["a"].arrayOf(hi["a"].shape({type:hi["a"].string.def(""),fieldKey:hi["a"].string.isRequired,fieldName:hi["a"].string.isRequired,canView:hi["a"].bool.isRequired,canWrite:hi["a"].bool.isRequired,require:hi["a"].bool.isRequired,editable:hi["a"].bool.isRequired,textVisible:hi["a"].bool.isRequired,useCondition:hi["a"].bool.isRequired}))},data:function(){var e=this.getValue("participant"),t=this.getValue("canRollback");return{optionalTypes:ft,optionalScope:ht,participantTypesOpts:Zi(ie),participantTypes:ie,taskRuleTypes:re,approveOrderEnum:on,participant:Object(p["a"])(Object(p["a"])({},e),{},{scope:e.scope||nn.ALL}),stationVisible:!1,opinionSetting:this.getValue("opinionSetting"),taskRule:this.getValue("taskRule"),canTransfer:this.getValue("canTransfer"),canRollback:null===t||void 0===t||t,participantEmptyRule:this.getValue("participantEmptyRule")===se.AUTO_COMPLETE||!1,initiatorAutoComplete:this.getValue("initiatorAutoComplete")||!1,rollbackSubmitType:this.getValue("rollbackSubmitType"),pickerType:null,isDirectRollback:!1}},computed:{computedTrasfersList:function(){var e=(this.transfer||{}).list;return(e&&e.length?e:[]).map((function(e){var t=e.model,i=void 0===t?{}:t;return i}))},computedParticipantsList:function(){var e=this,t=this.participant.list,i=this.participant.type===H.POSITION_LABEL||this.isOptionalPersonal&&this.participant.optionalScope===pt.ASSIGN_POSITION_LABEL;return(t&&t.length?t:[]).map((function(t){var n;return Object(p["a"])(Object(p["a"])({},t),{},(n={},Object(b["a"])(n,i?"positionName":"nodeName",t.name),Object(b["a"])(n,"parentFullName",t.parentFullName),Object(b["a"])(n,"sysNo",t.value),Object(b["a"])(n,"key",i?t.value:"".concat(t.value,"-").concat(ue[e.pickerType])),n))}))},formRoleFields:function(){return this.fields.filter((function(e){var t=e.type;return t===ee.JOB}))},formDepartmentFields:function(){return this.fields.filter((function(e){var t=e.type;return t===ee.DEPARTMENT}))},selectOptions:function(){return this.getSelectOptions()},showAddBtn:function(){return!this.showSelect&&!this.isSelf&&!this.isOptionalPersonal},showClearBtn:function(){return this.participant.list&&this.participant.list.length},showSelect:function(){return Boolean(te[this.participant.type])},showPositionLabelSelection:function(){return this.participant.type===H.POSITION_LABEL},isSelf:function(){return this.participant.type===H.INITIATOR},isDraggable:function(){return this.participant.scope&&this.participant.scope===nn.PRIORITY},isAssignType:function(){return[pt.ASSIGN_POSITION,pt.ASSIGN_USER,pt.ASSIGN_POSITION_LABEL].includes(this.participant.optionalScope)},pickerVisible:{get:function(){return!!this.pickerType},set:function(e){if(!e)return this.pickerType&&(this.pickerType=null),!1}},isOptionalPersonal:function(){return this.participant.type===H.OPTIONAL_PERSONNEL}},watch:{"participant.type":function(){this.participant.list=[],this.participant.formFieldKey&&(this.participant.formFieldKey=null),this.node.read(""),this.isOptionalPersonal&&(Reflect.has(this.participant,"optionalType")||this.$set(this.participant,"optionalType","single"),Reflect.has(this.participant,"optionalScope")||this.$set(this.participant,"optionalScope",pt.TENANT_ORGANIZATION))},"participant.formFieldKey":function(e){e?this.node.read(ie[this.participant.type]+"："+(this.fields.find((function(t){return t.fieldKey===e}))||{}).fieldName||""):this.node.read("")},"participant.list":function(e){var t=this;if(this.isSelf)this.node.read(this.participantTypes[this.participant.type]);else if(this.showSelect){var i=((this.selectOptions||[]).find((function(e){var i=e.value;return i===t.participant.formFieldKey}))||{}).label||"";this.node&&this.node.read(i)}else if(this.isOptionalPersonal&&!this.isAssignType){var n=ht.find((function(e){return e.value===t.participant.optionalScope}))||{};n.label&&this.node.read("".concat(this.participantTypes[this.participant.type],"(").concat(n.label,")"))}else e.length?this.node.read({list:e}):this.node.read("")},participant:{deep:!0,handler:function(){this.node.read()&&this.node.model.errorState&&(this.node.model.errorState=!1),this.handleUpdateProps("participant")}},opinionSetting:{deep:!0,handler:function(e){e.writeSignatureEnabled?e.writeSignatureRequired||(e.writeSignatureRequired=!0):(e.writeSignatureRequired&&(e.writeSignatureRequired=!1),e.writeSignatureCanUseLast&&(e.writeSignatureCanUseLast=!1)),!e.textOpinionEnabled&&e.textOpinionRequired&&(e.textOpinionRequired=!1),this.handleUpdateProps("opinionSetting")}},taskRule:function(){this.handleUpdateProps("taskRule")},canTransfer:function(){this.handleUpdateProps("canTransfer")},canRollback:function(){this.canRollback||(this.isDirectRollback=!1),this.handleUpdateProps("canRollback")},participantEmptyRule:function(e){this.node&&this.node.updateProps({participantEmptyRule:e?se.AUTO_COMPLETE:se.CANNOT_SUBMIT})},initiatorAutoComplete:function(){this.handleUpdateProps("initiatorAutoComplete")},isDirectRollback:{immediate:!0,handler:function(e){this.node&&this.node.updateProps({rollbackSubmitType:e?qi.BACK_TRACKED:qi.SEQUENCE})}},rollbackSubmitType:{immediate:!0,handler:function(e){this.isDirectRollback=e!==qi.SEQUENCE}}},created:function(){this.isOptionalPersonal?this.participant.optionalScope===pt.ASSIGN_POSITION&&Ji({list:this.participant.list,type:H.POSITION}):Ji(this.participant),this.APPROVE_ORDER_TYPE=nn},methods:{generateBtnName:function(){var e=this;if([pt.ASSIGN_POSITION_LABEL,pt.ASSIGN_POSITION,pt.ASSIGN_USER].includes(this.participant.optionalScope)){var t=(this.optionalScope.find((function(t){return t.value===e.participant.optionalScope}))||{}).label;if(t)return"选择".concat(t.substring(2))}},handleOptional:function(){this.participant.optionalScope===pt.ASSIGN_POSITION_LABEL?this.stationVisible=!0:this.pickerType=this.participant.optionalScope===pt.ASSIGN_POSITION?W.ROLE:W.USER},handleScopeClose:function(e){this.participant.list.splice(e,1)},getValue:function(e){if(this.node&&this.node.props){var t=this.node.props[e],i="object"===Object(h["a"])(this.node.props[e]);return i?Ie(Object(p["a"])(Object(p["a"])({},Pe[this.node.type][e]),this.node.props[e])):t}},getSelectOptions:function(){if(this.showSelect){var e=this.participant.type;if(e===H.POSITION_OF_FORM||e===H.ORGANIZATION_POSITION_OF_FORM)return an(this.formRoleFields)||[];if(e===H.DEPARTMENT_OF_FORM||e===H.DEPARTMENT_POSITION_OF_FORM)return an(this.formDepartmentFields)||[]}return[]},handleChange:function(e){this.node&&this.node.update({title:e})},handleUpdateProps:function(e){this.node&&this.node.updateProps(Object(b["a"])({},e,this[e]))},handleAddPeople:function(){this.participant.type===H.POSITION_LABEL?this.stationVisible=!0:this.pickerType=Z[this.participant.type]||null},handleConfirmPicker:function(e){var t=this;this.isOptionalPersonal?(this.participant.list=e.map((function(e){return t.participant.optionalScope===pt.ASSIGN_USER?{name:e.name,value:e.sysNo,hasUser:!0,model:{userName:e.name,userSysNo:e.sysNo,unitType:H.OPTIONAL_PERSONNEL}}:t.participant.optionalScope===pt.ASSIGN_POSITION?{name:e.name,value:e.sysNo,hasUser:void 0,model:{positionName:e.name,positionSysNo:e.sysNo,unitType:H.OPTIONAL_PERSONNEL}}:void 0})),this.participant.optionalScope===pt.ASSIGN_POSITION&&Ji({list:this.participant.list,type:H.POSITION})):(this.participant.list=e,Ji(this.participant))},handleCallBack:function(e){this.participant.list=e.map((function(e){return Object(p["a"])(Object(p["a"])({},e),{},{name:e.positionName,parentFullName:e.parentFullName,organizationType:e.organizationType,value:e.sysNo,hasUser:void 0,model:{positionLabelSysNo:e.sysNo,positionLabelName:e.positionName,parentFullName:e.parentFullName,organizationType:e.organizationType,unitType:H.POSITION_LABEL}})}))},handleDeleteTag:function(e,t){e.splice(e.indexOf(t),1)},handleClearTags:function(){this.participant.list=[]}}},sn=rn,ln=(i("fd74"),i("bb1d"),Object(yi["a"])(sn,Fi,Bi,!1,null,"24a56bc0",null)),cn=ln.exports,dn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("PanelBlock",{attrs:{title:"抄送人节点名称"}},[i("el-input",{attrs:{size:"mini"},on:{change:e.handleChange},model:{value:e.node.model.title,callback:function(t){e.$set(e.node.model,"title",t)},expression:"node.model.title"}})],1),i("PanelBlock",{attrs:{title:"抄送人设置"}},[i("el-radio-group",{staticClass:"flow-panel-radios",model:{value:e.participant.type,callback:function(t){e.$set(e.participant,"type",t)},expression:"participant.type"}},[i("el-row",e._l(e.participantTypes,(function(t,n){return i("el-col",{key:n,attrs:{span:8}},[i("el-radio",{attrs:{title:t,label:n}},[e._v(e._s(t))])],1)})),1)],1),e.showAddBtn?i("div",{staticClass:"flow-panel-button"},[i("el-button",{attrs:{size:"mini",icon:"el-icon-plus",type:"primary"},on:{click:e.handleAddPeople}},[e._v("添加"+e._s(e.participantTypes[e.participant.type]))])],1):e._e(),e.showAddBtn&&e.participant.list&&e.participant.list.length?i("div",{staticClass:"flow-panel-radios"},[e._l(e.participant.list,(function(t){return[!1===t.hasUser?i("el-popover",{key:t.value,attrs:{"popper-class":"flow-panel-popover",trigger:"hover","visible-arrow":!1,content:"该"+e.participantTypes[e.participant.type]+"中无用户存在",placement:"top"}},[i("el-tag",{key:t.value,attrs:{slot:"reference",size:"mini","disable-transitions":"",closable:""},on:{close:function(i){return e.handleDeleteTag(e.participant.list,t)}},slot:"reference"},[i("span",[e._v(e._s(t.name)+" "+e._s(t.parentFullName?"("+t.parentFullName+")":""))]),i("i",{staticClass:"el-icon-warning"})])],1):i("el-tag",{key:t.value,attrs:{size:"mini","disable-transitions":"",closable:""},on:{close:function(i){return e.handleDeleteTag(e.participant.list,t)}}},[i("span",[e._v(e._s(t.name)+" "+e._s(t.parentFullName?"("+t.parentFullName+")":""))])])]})),i("el-button",{attrs:{size:"mini",type:"text"},on:{click:e.handleClearTags}},[e._v("清空")])],2):e._e()],1),e._t("table"),i("SubmitPicker",e._b({attrs:{show:e.pickerVisible,type:e.pickerType,"participant-type":e.participant.type,"default-selected":e.computedParticipantsList},on:{"update:show":function(t){e.pickerVisible=t},confirm:e.handleConfirmPicker}},"SubmitPicker",e.$attrs,!1)),i("PositionPicker",{attrs:{title:"选择岗位标签",show:e.stationVisible,multiple:"","list-key-name":"parentFullName","role-list":e.computedParticipantsList},on:{"update:show":function(t){e.stationVisible=t},addCallBack:e.handleCallBack}})],2)},un=[],pn={name:"NotifierPanel",type:q.NOTIFIER_NODE,components:{PanelBlock:Ti,SubmitPicker:Gi,PositionPicker:function(){return xi["a"].Lazy("auth2.components.PositionPicker")}},inheritAttrs:!1,props:{node:hi["a"].instanceOf(ot).required},data:function(){var e=this.getValue("participant");return{participantTypes:ce,participant:e,stationVisible:!1,pickerType:W[e.type],pickerVisible:!1}},computed:{computedParticipantsList:function(){var e=this,t=this.participant.list,i=this.participant.type===H.POSITION_LABEL;return(t&&t.length?t:[]).map((function(t){var n;return n={},Object(b["a"])(n,i?"positionName":"nodeName",t.name),Object(b["a"])(n,"sysNo",t.value),Object(b["a"])(n,"parentFullName",t.parentFullName||""),Object(b["a"])(n,"key",i?t.value:"".concat(t.value,"-").concat(ue[e.pickerType])),n}))},showAddBtn:function(){return Boolean(!te[this.participant.type]&&!this.fromSelf)},fromSelf:function(){return this.participant.type===H.INITIATOR}},watch:{"participant.type":function(){this.participant.list=[],this.node.read("")},participant:{deep:!0,handler:function(e){this.fromSelf?this.node.read(this.participantTypes[e.type]):this.node&&this.node.read(e),this.node.read()&&this.node.model.errorState&&this.node.update({errorState:!1}),this.handleUpdateProps("participant")}}},created:function(){Ji(this.participant)},methods:{getValue:function(e){if(this.node&&this.node.props){var t=this.node.props[e],i="object"===Object(h["a"])(this.node.props[e]);return i?Ie(Object(p["a"])(Object(p["a"])({},Pe[this.node.type][e]),this.node.props[e])):t}},handleChange:function(e){this.node.update({title:e})},handleUpdateProps:function(e){this.node&&this.node.updateProps(Object(b["a"])({},e,this[e]))},handleAddPeople:function(){this.participant.type===H.POSITION_LABEL?this.stationVisible=!0:(this.pickerType=Z[this.participant.type]||null,this.pickerVisible=!0)},handleCallBack:function(e){this.participant.list=e.map((function(e){return{name:e.positionName,value:e.sysNo,parentFullName:e.parentFullName,organizationType:e.organizationType,hasUser:void 0,model:{positionLabelSysNo:e.sysNo,positionLabelName:e.positionName,parentFullName:e.parentFullName,organizationType:e.organizationType,unitType:H.POSITION_LABEL}}}))},handleConfirmPicker:function(e){this.participant.list=e,Ji(this.participant)},handleDeleteTag:function(e,t){e.splice(e.indexOf(t),1)},handleClearTags:function(){this.participant.list=[]}}},fn=pn,hn=Object(yi["a"])(fn,dn,un,!1,null,null,null),On=hn.exports,Nn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("PanelBlock",{attrs:{title:"并行节点名称"}},[i("el-input",{attrs:{size:"mini"},on:{change:e.handleChange},model:{value:e.node.model.title,callback:function(t){e.$set(e.node.model,"title",t)},expression:"node.model.title"}})],1)},bn=[],mn={name:"ParallelPanel",type:q.PARALLEL_NODE,components:{PanelBlock:Ti},props:{node:hi["a"].instanceOf(ot).required},methods:{handleChange:function(e){this.node&&this.node.update({title:e})}}},yn=mn,vn=Object(yi["a"])(yn,Nn,bn,!1,null,null,null),Tn=vn.exports,En=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("PanelBlock",{attrs:{title:"条件节点名称"}},[i("el-input",{attrs:{size:"mini"},on:{change:e.handleChange},model:{value:e.node.model.title,callback:function(t){e.$set(e.node.model,"title",t)},expression:"node.model.title"}})],1)},_n=[],gn={name:"ConditionPanel",type:q.CONDITION_NODE,components:{PanelBlock:Ti},props:{node:hi["a"].instanceOf(ot).required},methods:{handleChange:function(e){this.node&&this.node.update({title:e})}}},Pn=gn,In=Object(yi["a"])(Pn,En,_n,!1,null,null,null),An=In.exports,Rn={name:"BasePanel",components:{Sponsor:Di,Approver:cn,Notifier:On,Parallel:Tn,Condition:An,PanelBlock:Ti,PanelPermissionTable:Si},inheritAttrs:!1,props:{node:hi["a"].instanceOf(ot).required,fields:hi["a"].arrayOf(hi["a"].shape({type:hi["a"].string.def(""),fieldKey:hi["a"].string.isRequired,fieldName:hi["a"].string.isRequired,canView:hi["a"].bool.isRequired,canWrite:hi["a"].bool.isRequired,require:hi["a"].oneOf([!0,!1,void 0]).isRequired,editable:hi["a"].bool.isRequired,textVisible:hi["a"].bool.isRequired,useCondition:hi["a"].bool.isRequired})),joinPlan:hi["a"].oneOf([1,2,3]).isRequired},data:function(){return{activeName:"node",showPermissionEdit:!0,showPermissionPanel:!0,getFlowFormInfo:{},getFlowBaseInfo:{}}},computed:{computedType:function(){return this.node&&this.node.type||"base"},computedNode:function(){var e=this;return Object.values(Rn.components).find((function(t){return t.type&&t.type===e.computedType}))},needPermissionTable:function(){return[ot.TYPE.SPONSOR_NODE,ot.TYPE.APPROVER_NODE,ot.TYPE.NOTIFIER_NODE].includes(this.node&&this.node.type)}},watch:{node:function(){this.resetInnerState(),this.node&&this.handleJoinPlan()}},mounted:function(){this.handleJoinPlan(this.joinPlan),window.addEventListener("keydown",this.handleKeyPress)},beforeDestroy:function(){window.removeEventListener("keydown",this.handleKeyPress)},methods:{handleKeyPress:function(e){27===e.keyCode&&this.$attrs.visible&&this.$emit("update:visible",!1)},resetInnerState:function(){this.activeName="node",this.showPermissionPanel=!0},handleJoinPlan:function(){var e=this.joinPlan,t=this.node&&this.node.type===ot.TYPE.SPONSOR_NODE;2===e&&t&&(this.showPermissionPanel=!1),3===e&&(this.showPermissionPanel=!1)}}},Sn=Rn,kn=Sn,Cn=(i("fadd"),Object(yi["a"])(kn,pi,fi,!1,null,null,null)),jn=Cn.exports,Ln=i("2638"),wn=i.n(Ln),Dn=(i("302a"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"flow-node",class:e.type+"-node"},[e.computedNode?i(e.computedNode,e._g(e._b({tag:"component"},"component",e.$attrs,!1),e.$listeners)):e._e(),e.showAddBtn?i("BaseAddBtn",e._g(e._b({staticClass:"flow-node-button",attrs:{type:"primary",circle:""}},"BaseAddBtn",e.$attrs,!1),e.computedListeners)):e._e()],1)}),Fn=[],Bn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.branchType?i("div",[i("el-button",e._g(e._b({attrs:{size:"mini",icon:"el-icon-plus"},on:{click:function(t){return e.handleAddNode(e.branchType)}}},"el-button",e.$attrs,!1),e.$listeners),[e._t("default")],2)],1):e.editable?i("el-popover",{attrs:{placement:"right",width:"100","popper-class":"flow-type-wrapper"},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[i("div",{staticClass:"flow-type"},e._l(e.types,(function(t){var n=t.type,o=t.icon,a=t.name,r=t.styles;return i("a",{key:a,staticClass:"flow-type-item",attrs:{href:"javascript:void(0)",title:"添加"+a+"节点"},on:{click:function(t){return e.handleAddNode(n)}}},[i("div",{staticClass:"flow-type-item__icon",style:r},[i("i",{class:""+o})]),i("div",{staticClass:"flow-type-item__name"},[e._v(e._s(a))])])})),0),i("template",{slot:"reference"},[i("el-button",e._g(e._b({attrs:{size:"mini",icon:"el-icon-plus"}},"el-button",e.$attrs,!1),e.$listeners),[e._t("default")],2)],1)],2):i("div",{staticClass:"flow-node-button--gap"})},xn=[],Vn=[{type:q.APPROVER_NODE,name:K[q.APPROVER_NODE].title,icon:K[q.APPROVER_NODE].titleIcon,styles:{color:K[q.APPROVER_NODE].customTitleStyle.backgroundColor}},{type:q.CONDITION_BRANCH,name:K[q.CONDITION_BRANCH].title,icon:K[q.CONDITION_BRANCH].titleIcon,styles:{color:K[q.CONDITION_NODE].customTitleStyle.color}},{type:q.PARALLEL_BRANCH,name:K[q.PARALLEL_BRANCH].title,icon:K[q.PARALLEL_BRANCH].titleIcon,styles:{color:K[q.PARALLEL_NODE].customTitleStyle.color}},{type:q.NOTIFIER_NODE,name:K[q.NOTIFIER_NODE].title,icon:K[q.NOTIFIER_NODE].titleIcon,styles:{color:K[q.NOTIFIER_NODE].customTitleStyle.backgroundColor}}],Mn={name:"BaseAddBtn",inheritAttrs:!1,props:{branchType:hi["a"].oneOf([ot.TYPE.CONDITION_NODE,ot.TYPE.PARALLEL_NODE,!1]).def(!1),editable:hi["a"].bool.def(!0),node:hi["a"].instanceOf(ot).required,fields:hi["a"].arrayOf(hi["a"].shape({type:hi["a"].string.def(""),fieldKey:hi["a"].string.isRequired,fieldName:hi["a"].string.isRequired,canView:hi["a"].bool.isRequired,canWrite:hi["a"].bool.isRequired,require:hi["a"].oneOf([!0,!1,void 0]).isRequired,editable:hi["a"].bool.isRequired,textVisible:hi["a"].bool.isRequired,useCondition:hi["a"].bool.isRequired}))},data:function(){return{visible:!1,types:Vn}},methods:{handleAddNode:function(e){var t=this.needMergeFields(e)?{type:e,formFieldList:gt(this.fields)(e===ot.TYPE.PARALLEL_BRANCH?ot.TYPE.APPROVER_NODE:e)}:{type:e},i=this.node&&this.node.add(t);this.visible=!1,this.$emit("update-node",i.getRootNode(i))},needMergeFields:function(e){return Ze(e)||e===ot.TYPE.PARALLEL_BRANCH}}},Un=Mn,$n=Object(yi["a"])(Un,Bn,xn,!1,null,null,null),Yn=$n.exports,Gn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",e._g(e._b({staticClass:"node",class:e.errorState&&"node-warning"},"div",e.$attrs,!1),e.$listeners),[i("div",{staticClass:"node-title",style:e.customTitleStyle,attrs:{title:e.title}},[e.$slots.header?[e._t("header")]:[i("div",{staticClass:"node-title-text",attrs:{title:e.title}},[e.titleIcon?i("div",{staticClass:"node-title-icon"},[i("i",{class:""+e.titleIcon})]):e._e(),e.$slots.title?e._t("title"):i("span",[e._v(e._s(e.title))])],2),e.showRemove&&e.editable?i("a",{staticClass:"node-close-icon",attrs:{title:"删除该节点",href:"javascript:void(0)"},on:{click:function(t){return t.stopPropagation(),e.handleRemoveNode(t)}}},[i("i",{class:"el-icon-close"})]):e._e()]],2),e.errorState||e.content||e.placeholder?i("div",{staticClass:"node-content",attrs:{title:e.errorState||e.content||"点击设置"}},[i("div",{staticClass:"node-content-text"},[e.errorState?i("span",{staticClass:"error-message"},[e._v(e._s(e.errorState))]):e.content?e._t("default",[[e._v(e._s(e.content))]]):i("span",{staticClass:"placeholder"},[e._v(e._s(e.placeholder))])],2),e.contentIcon&&e.editable?i("div",{staticClass:"node-content-icon"},[i("i",{class:""+e.contentIcon})]):e._e()]):e._e()])},qn=[],Kn={name:"BaseNode",inheritAttrs:!1,props:{editable:hi["a"].bool.def(!0),showRemove:hi["a"].bool.def(!0),title:hi["a"].string.isRequired,content:hi["a"].string.def(""),placeholder:hi["a"].string.def("请填写内容"),titleIcon:hi["a"].string.def(""),contentIcon:hi["a"].string.def(""),customTitleStyle:hi["a"].any.def({}),errorState:hi["a"].oneOfType([hi["a"].bool,hi["a"].string]).def(!1),node:hi["a"].instanceOf(ot).required},methods:{handleRemoveNode:function(){var e=this.node&&this.node.remove(this,this.index);this.$emit("update-node",e.getRootNode(e))}}},zn=Kn,Hn=Object(yi["a"])(zn,Gn,qn,!1,null,null,null),Wn=Hn.exports,Jn=q.SPONSOR_NODE,Zn=K[Jn],Qn={name:"SponsorNode",type:Jn,components:{BaseNode:Wn},inheritAttrs:!1,props:{node:hi["a"].instanceOf(Node).required},render:function(e){return e("BaseNode",{props:Object(p["a"])(Object(p["a"])(Object(p["a"])({},Zn),this.node.model),{},{node:this.node,showRemove:!1}),attrs:this.$attrs,on:this.$listeners})}},Xn=Qn,eo=Object(yi["a"])(Xn,qt,Kt,!1,null,null,null),to=eo.exports,io=q.APPROVER_NODE,no=K[io],oo={name:"ApproverNode",type:io,components:{BaseNode:Wn},inheritAttrs:!1,props:{node:hi["a"].instanceOf(Node).required},render:function(e){return e("BaseNode",{props:Object(p["a"])(Object(p["a"])(Object(p["a"])({},no),this.node.model),{},{node:this.node}),attrs:this.$attrs,on:this.$listeners})}},ao=oo,ro=Object(yi["a"])(ao,zt,Ht,!1,null,null,null),so=ro.exports,lo=q.NOTIFIER_NODE,co=K[lo],uo={name:"NotifierNode",type:lo,components:{BaseNode:Wn},inheritAttrs:!1,props:{node:hi["a"].instanceOf(Node).required},render:function(e){return e("BaseNode",{props:Object(p["a"])(Object(p["a"])(Object(p["a"])({},co),this.node.model),{},{node:this.node}),attrs:this.$attrs,on:this.$listeners})}},po=uo,fo=Object(yi["a"])(po,Wt,Jt,!1,null,null,null),ho=fo.exports,Oo=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",e._g(e._b({staticClass:"branch-node",class:e.errorState&&"branch-node-warning",attrs:{title:e.computedNodeTitle}},"div",e.$attrs,!1),e.$listeners),[e.showArrowLeft?i("div",{staticClass:"branch-node-icon-left",attrs:{title:"左移"},on:{click:function(t){return t.stopPropagation(),e.handleMoveForward(t)}}},[i("i",{staticClass:"el-icon-arrow-left"})]):e._e(),i("div",{staticClass:"branch-node-inner"},[e.title?i("div",{staticClass:"branch-node-title",style:e.model.customTitleStyle},[i("div",{staticClass:"branch-node-title-text"},[i("span",[e._v(e._s(e.title))])]),i("div",{staticClass:"branch-node-priority"},[e._v(e._s(e.priority))]),e.showRemove&&e.editable?i("a",{staticClass:"branch-node-icon-close",attrs:{title:"删除该节点",href:"javascript:void(0)"},on:{click:function(t){return t.stopPropagation(),e.handleRemoveNode(t)}}},[i("i",{class:"el-icon-close"})]):e._e()]):e._e(),e.errorState||e.model.content||e.model.placeholder?i("div",{staticClass:"branch-node-content",attrs:{title:e.errorState||e.model.content||"点击设置"}},[i("div",{staticClass:"branch-node-content-text"},[e.errorState?i("span",{staticClass:"error-message"},[e._v(e._s(e.errorState))]):e.model.content?e._t("default",[[e._v(e._s(e.model.content))]]):i("span",{staticClass:"placeholder"},[e._v(e._s(e.model.placeholder))])],2)]):e._e()]),e.showArrowRight?i("div",{staticClass:"branch-node-icon-right",attrs:{title:"右移"},on:{click:function(t){return t.stopPropagation(),e.handleMoveBackward(t)}}},[i("i",{staticClass:"el-icon-arrow-right"})]):e._e()])},No=[],bo={name:"BaseBranchNode",inheritAttrs:!1,props:{movable:hi["a"].bool.def(!0),editable:hi["a"].bool.def(!0),showRemove:hi["a"].bool.def(!0),index:hi["a"].number.def(0),total:hi["a"].number.def(0),node:hi["a"].instanceOf(ot).required,graph:hi["a"].instanceOf(lt).required},computed:{type:function(){return this.node&&this.node.type},settings:function(){return K[this.type]},model:function(){return Object(p["a"])(Object(p["a"])({},this.settings),this.node&&this.node.model)},errorState:function(){return this.model.errorState},title:function(){return this.settings.title===this.model.title?this.settings.title+(this.index+1):this.model.title},priority:function(){return"优先级"+(this.index+1)},showArrowLeft:function(){return this.editable&&this.index>0},showArrowRight:function(){return this.movable&&this.editable&&this.index<this.total&&this.index!==this.total},computedNodeTitle:function(){var e=this.showRemove,t=this.editable,i="";return e&&t?i="点击设置":e||t?e?t||(i="不可编辑"):i="不可移动":i="不可编辑，不可移动",i}},watch:{"model.content":function(e){e&&this.errorState&&(this.node.model.errorState=!1)}},methods:{handleRemoveNode:function(){var e=this.node&&this.node.remove(this,this.index);this.$emit("update-node",e.getRootNode(e))},handleMoveForward:function(){this.node&&this.node.move(this.index,this.index-1)},handleMoveBackward:function(){this.node&&this.node.move(this.index,this.index+1)}}},mo=bo,yo=Object(yi["a"])(mo,Oo,No,!1,null,null,null),vo=yo.exports,To={name:"ConditionNode",type:q.CONDITION_NODE,components:{BaseBranchNode:vo},inheritAttrs:!1,computed:{isLast:function(){return Ke(this.$attrs.node)},isPrevOfLast:function(){var e=et(this.$attrs.node);return e&&Ke(e)}},render:function(e){return e("BaseBranchNode",{attrs:Object(p["a"])(Object(p["a"])({},this.$attrs),{},{movable:!this.isPrevOfLast&&!this.isLast,node:this.isLast?Object(p["a"])(Object(p["a"])({},this.$attrs.node),{},{model:Object(p["a"])(Object(p["a"])({},this.$attrs.node.model),{},{content:"其他情况"})}):this.$attrs.node,showRemove:!this.isLast,editable:!this.isLast}),nodeProps:this.isLast?{title:"其他条件节点不可编辑"}:null,style:this.isLast?{cursor:"not-allowed"}:null,on:this.isLast?null:this.$listeners})}},Eo=To,_o=Object(yi["a"])(Eo,Zt,Qt,!1,null,null,null),go=_o.exports,Po={name:"ParallelNode",type:q.PARALLEL_NODE,components:{BaseBranchNode:vo},inheritAttrs:!1,render:function(e){return e("BaseBranchNode",{attrs:this.$attrs,on:this.$listeners})}},Io=Po,Ao=Object(yi["a"])(Io,Xt,ei,!1,null,null,null),Ro=Ao.exports,So=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"end-node"},[i("div",{staticClass:"end-node-circle"}),i("div",{staticClass:"end-node-text"},[e._v(e._s(e.text))])])},ko=[],Co=q.END_NODE,jo=K[Co],Lo={name:"EndNode",type:Co,data:function(){return{text:jo.content}}},wo=Lo,Do=Object(yi["a"])(wo,So,ko,!1,null,null,null),Fo=Do.exports,Bo={name:"FlowNode",components:{BaseAddBtn:Yn,SponsorNode:to,ApproverNode:so,NotifierNode:ho,ConditionNode:go,ParallelNode:Ro,EndNode:Fo},inheritAttrs:!1,props:{type:hi["a"].oneOf(Object.values(q).filter((function(e){return!He(e)}))).isRequired},computed:{computedNode:function(){var e=this;return Object.values(Bo.components).find((function(t){return t.type&&t.type===e.type}))},showAddBtn:function(){return"end"!==this.type},computedListeners:function(){var e=this.$listeners,t=(e.click,Object(u["a"])(e,["click"]));return Object(p["a"])({},t)}}},xo=Bo,Vo=xo,Mo=Object(yi["a"])(Vo,Dn,Fn,!1,null,null,null),Uo=Mo.exports,$o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"flow-branch-col"},[e.left?[i("div",{staticClass:"flow-branch-col-line left top"}),i("div",{staticClass:"flow-branch-col-line left btm"})]:e._e(),i("div",{staticClass:"flow-branch-col-inner"},[e._t("default",null,null,e.$attrs)],2),e.right?[i("div",{staticClass:"flow-branch-col-line right top"}),i("div",{staticClass:"flow-branch-col-line right btm"})]:e._e()],2)},Yo=[],Go={name:"FlowBranchCol",props:{left:hi["a"].bool.def(!1),right:hi["a"].bool.def(!1)}},qo=Go,Ko=Object(yi["a"])(qo,$o,Yo,!1,null,null,null),zo=Ko.exports,Ho=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"flow-branch-node"},[e.btnText?i("BaseAddBtn",e._b({staticClass:"flow-branch-button",attrs:{"branch-type":e.nodeType}},"BaseAddBtn",e.$attrs,!1),[e._v(e._s(e.btnText))]):e._e(),i("div",{staticClass:"flow-branch",class:[e.type,e.$attrs.editable&&"flow-branch--gap"]},[i("div",{staticClass:"flow-branch-node-inner"},[e._t("default")],2)])],1)},Wo=[],Jo={name:"FLowBranchNode",components:{BaseAddBtn:Yn},inheritAttrs:!1,props:{type:hi["a"].oneOf(Object.values(q).filter(He)).isRequired,nodeType:hi["a"].oneOf(Object.values(q).filter((function(e){return!He(e)})).concat(!1)).isRequired},computed:{btnText:function(){return(K[this.type]||{})["btnText"]||""}}},Zo=Jo,Qo=Object(yi["a"])(Zo,Ho,Wo,!1,null,null,null),Xo=Qo.exports,ea={name:"FlowLayout",adapters:{toJSON:ai,toModel:Bt},components:{FlowNode:Uo,FlowBranchCol:zo,FlowBranchNode:Xo},inheritAttrs:!1,props:{rootNode:hi["a"].instanceOf(ot).required,currNode:hi["a"].instanceOf(ot).required,editable:hi["a"].bool.def(!0)},computed:{graph:function(){return this.node&&this.node.graph}},mounted:function(){this.$emit("loaded")},methods:{renderNode:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.$createElement;if(!e)return null;var o=e.type,a=void 0===o?"":o,r=e.childNode,s=e.childrenNodes,l=e.isBranchNode(),c={attrs:this.$attrs,class:{"is-active":this.currNode===e}};return this.editable&&(c.on=Object(p["a"])(Object(p["a"])({},this.$listeners),{},{click:function(){t.$emit("click-node",e,i)}})),[a&&!l&&n(Uo,wn()([{attrs:Object(b["a"])({type:a,node:e,editable:this.editable,index:i.index,total:i.total},"node",e)},c])),l&&s&&s.length&&this.renderBranchNode(s,e,a),r&&this.renderNode(r)]},renderBranchNode:function(e,t,i){var n=this,o=this.$createElement,a=Je(i),r=e.length-1,s={attrs:this.$attrs};return this.editable&&(s.on=Object(p["a"])({},this.$listeners)),o(Xo,wn()([{attrs:{type:i,nodeType:this.editable&&a,editable:this.editable,node:t}},s]),[e.map((function(e,t){return o(zo,{attrs:{left:0===t,right:t===r}},[n.renderNode(e,{index:t,total:r})])}))])}},render:function(){var e=arguments[0];return e("div",{class:"flow-layout"},[this.renderNode(this.rootNode),e(Uo,{attrs:{type:"end"}})])}},ta=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",e._g(e._b({},"el-dialog",e.$attrs,!1),e.$listeners),[e._t("title",null,{slot:"title"}),i("el-form",{ref:"conditionsForm",staticClass:"flow-condition",attrs:{model:e.form,size:"mini"},on:{submit:e.handleClickConfirm}},[e._l(e.form.conditions,(function(t,n){return[n>0?i("div",{key:""+t[0].key,staticClass:"flow-condition-group__logic"},[e._v(" "+e._s(e.LOGIC_SIGNS[t[0].unionLogic])+" ")]):e._e(),i("div",{key:n,staticClass:"flow-condition-group"},[i("div",{staticClass:"flow-condition-group__title"},[i("div",{staticClass:"flow-condition-group__title-text"},[e._v(" 条件组"+e._s(n+1)+" ")]),e.form.conditions.length>1?i("div",{staticClass:"flow-condition-group__title-del"},[i("el-button",{attrs:{type:"text",icon:"el-icon-delete",size:"mini"},on:{click:function(){return e.handleRemoveConditionGroup(n)}}})],1):e._e()]),i("div",{staticClass:"flow-condition-group__content"},[e._l(t,(function(t,o){return i("div",{key:t.key,staticClass:"flow-condition-item"},[o>0&&t.unionLogic&&e.LOGIC_SIGNS[t.unionLogic]?i("div",{staticClass:"flow-condition-item__logic"},[e._v(" "+e._s(e.LOGIC_SIGNS[t.unionLogic])+" ")]):e._e(),i("el-row",{attrs:{gutter:10}},[i("el-col",{attrs:{span:9}},[i("el-form-item",{staticClass:"flow-condition-item",attrs:{prop:"conditions."+n+"."+o+".fieldKey",size:"mini",rules:[{required:!0,message:"请选择条件字段",trigger:["blur","change"]}]}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择字段","aria-placeholder":"选择字段"},on:{change:function(i){return e.handleChange(t)}},model:{value:t.fieldKey,callback:function(i){e.$set(t,"fieldKey",i)},expression:"condition.fieldKey"}},e._l(e.selectOptions,(function(t){return i("el-option",e._b({key:t.key},"el-option",t,!1))})),1)],1)],1),i("el-col",{attrs:{span:5}},[i("el-form-item",{attrs:{prop:"conditions."+n+"."+o+".conditionType",size:"mini",rules:[{required:!0,message:"请选择判断条件",trigger:["blur","change"]}]}},[i("el-select",{staticStyle:{width:"100%"},attrs:{disabled:!t.fieldKey,placeholder:"判断条件","aria-placeholder":"判断条件"},on:{change:function(i){return e.handleConditionTypeChange(t,i)}},model:{value:t.conditionType,callback:function(i){e.$set(t,"conditionType",i)},expression:"condition.conditionType"}},e._l(e.getConditionTypes(t),(function(e,t){return i("el-option",{key:e,attrs:{label:e,value:t}})})),1)],1)],1),i("el-col",{attrs:{span:9}},[i("el-form-item",{attrs:{prop:"conditions."+n+"."+o+".value",size:"mini",rules:[{required:!0,message:"请填写条件对应值",trigger:["blur","change"]}]}},[!Boolean(e.getPickerType(t))&&e.getFieldOptions(t)?i("el-select",{directives:[{name:"ref",rawName:"v-ref",value:function(i){return e.handleConditionPickerRef(t,i)},expression:"(ref) => handleConditionPickerRef(condition, ref)"}],attrs:{value:e.isMultipleType(t)?t.value:t.value[0],placeholder:"单选值","aria-placeholder":"值",multiple:e.isMultipleType(t)},on:{change:function(i){return e.handleConitionValueChange(t,i)}}},e._l(e.getFieldOptions(t),(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1):Boolean(e.getPickerType(t))||e.isPosition(t)?i("el-input",{staticStyle:{width:"100%"},attrs:{value:e.getFieldOptions(t),multiple:"",readonly:"",placeholder:"值","aria-placeholder":"值"},nativeOn:{click:function(i){return function(){return e.handleClickPickerInput(t)}()}}}):i("el-input",{staticStyle:{width:"100%"},attrs:{type:t.conditionCode,placeholder:"值","aria-placeholder":"值"},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"condition.value"}})],1)],1),e.form.conditions[n].length>1?i("el-col",{attrs:{span:1}},[i("div",{staticClass:"flow-condition-remove"},[i("el-button",{attrs:{type:"text",icon:"el-icon-remove",size:"mini"},on:{click:function(){return e.handleRemoveCondition(n,o)}}})],1)]):e._e()],1)],1)})),i("div",{staticClass:"flow-condition-action"},[i("el-button",{staticClass:"standard",attrs:{size:"mini",icon:"el-icon-plus",type:"primary",plain:""},on:{click:function(t){return e.handleAddCondition(n,{unionLogic:e.AND})}}},[e._v("且条件")]),i("el-button",{staticClass:"standard",attrs:{size:"mini",icon:"el-icon-plus",type:"primary",plain:""},on:{click:function(t){return e.handleAddCondition(n,{unionLogic:e.OR})}}},[e._v("或条件")])],1)],2)])]}))],2),i("div",{staticClass:"flow-condition-action"},[i("el-link",{attrs:{icon:"el-icon-plus",type:"primary",plain:""},on:{click:function(t){return e.handleAddConditionGroup({unionLogic:e.AND})}}},[e._v("且条件组")]),i("el-link",{staticStyle:{"margin-left":"20px"},attrs:{icon:"el-icon-plus",type:"primary",plain:""},on:{click:function(t){return e.handleAddConditionGroup({unionLogic:e.OR})}}},[e._v("或条件组")])],1),i("SubmitterPicker",{ref:"picker",attrs:{show:e.isSubmitterPickerVisible,multiple:"",title:e.computedPickerTitle,"default-selected":e.computedPickerValue,modal:"","append-to-body":!0,"select-lock":e.type||"user"},on:{"update:show":function(t){e.isSubmitterPickerVisible=t},onConfirm:e.handleConfirmPicker}}),i("TabTreePicker",{attrs:{"is-show-project":"project"===e.type,"is-show-company":"company"===e.type,show:e.isTabTreePickerVisible,multiple:"",title:e.computedPickerTitle,"default-selected":e.computedPickerValue,modal:"","append-to-body":!0,"exclude-types":[e.OrgNodeType.Department,e.OrgNodeType.ConstructUnit,e.OrgNodeType.ConstructUnitGroup],"select-lock":e.type||"user"},on:{"update:show":function(t){e.isTabTreePickerVisible=t},onConfirm:e.handleConfirmPicker}}),i("PositionPicker",{attrs:{title:"选择岗位标签","list-key-name":"nodeName",show:e.positionVisible,"role-list":e.computedPositionPickerValue},on:{"update:show":function(t){e.positionVisible=t},addCallBack:e.handleCallBack}}),i("template",{slot:"footer"},[i("el-button",{staticClass:"process",attrs:{type:"primary",plain:""},on:{click:e.handleClickCancel}},[e._v("取消")]),i("el-button",{staticClass:"process",attrs:{type:"primary"},on:{click:e.handleClickConfirm}},[e._v("确定")])],1)],2)},ia=[];i("fb6a"),i("ac16"),i("10d1");function na(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=!1,i=[],n=[],o=0;o<e.length;o++){var a=e[o];a&&(a.leftBracket&&a.rightBracket?(n.push([a]),i=[]):a.leftBracket?(i.push(a),t||(t=!0)):a.rightBracket?(i.push(a),t&&(t=!1),n.push(i.slice()),i=[]):i.push(a))}return!n.length&&i.length?[i]:n}function oa(e){var t,i=0,n=[],o=Object(st["a"])(e);try{for(o.s();!(t=o.n()).done;)for(var a=t.value,r=a.length-1,s=0;s<a.length;s++){var l=Object(p["a"])({},a[s]||{});0===s&&(l.leftBracket=!0),l.rightBracket=s===r,l.order=i++,n.push(l)}}catch(c){o.e(c)}finally{o.f()}return n}var aa=0,ra=1,sa=2,la=3,ca=4,da=5,ua=70,pa=80,fa=200,ha=300,Oa=400,Na=500,ba=501,ma=301;function ya(e){switch(e){case ra:return"公司";case sa:return"子公司";case la:return"项目";case ca:return"参建单位";case da:return"部门";case ua:return"岗位";case pa:return"用户"}}var va={Platform:aa,Company:ra,SubCompany:sa,Project:la,ConstructUnit:ca,Department:da,Role:ua,User:pa,SubCompanyGroup:fa,ProjectGroup:ha,ConstructUnitGroup:Oa,DepartmentGroup:Na,CompanyDepartmentGroup:ba,CompanyProjectGroup:ma,toString:ya},Ta="current_and_subordinate",Ea="current",_a="subordinate",ga=function(e){return e===W.ORGANIZATION?va.Company:e===W.PROJECT?va.Project:void 0},Pa=function(e){return e===ra||e===sa?Ta:e===la?Ea:e===fa?_a:e===ba||e===ma?Ea:void 0},Ia={bind:function(e,t,i){o["default"].nextTick((function(){t.value(i.componentInstance||e,i.key)})),t.value(i.componentInstance||e,i.key)},update:function(e,t,i,n){if(n.data&&n.data.directives){var o=n.data.directives.find((function(e){var t=e.name;return"ref"===t}));if(o&&o.value!==t.value)return o&&o.value(null,n.key),void t.value(i.componentInstance||e,i.key)}i.componentInstance===n.componentInstance&&i.elm===n.elm||t.value(i.componentInstance||e,i.key)},unbind:function(e,t,i){t.value(null,i.key)}},Aa={fieldKey:"",conditionType:"",conditionCode:"string",value:"",key:ot.getUUID(),order:1,leftBracket:!1,rightBracket:!1,unionLogic:null},Ra={name:"ConditionSettings",components:{TabTreePicker:function(){return xi["a"].Lazy("auth2.components.TabTreePicker")},PositionPicker:function(){return xi["a"].Lazy("auth2.components.PositionPicker")},SubmitterPicker:function(){return xi["a"].Lazy("auth2.components.SubmitterPicker")}},directives:{ref:Ia},inheritAttrs:!1,props:{node:hi["a"].instanceOf(ot).required,fields:hi["a"].arrayOf(hi["a"].shape({fieldKey:hi["a"].string.isRequired,fieldName:hi["a"].string.isRequired,fieldType:hi["a"].oneOf(Object.values(he)).isRequired,fieldOptions:hi["a"].arrayOf(hi["a"].shape({label:hi["a"].string.isRequired,value:hi["a"].oneOfType([hi["a"].string,hi["a"].number]).isRequired}))})),usingConditionFields:hi["a"].object.def({})},data:function(){var e=this.getValue("conditions").filter((function(e){return e&&e.value&&e.conditionCode&&e.conditionType})),t=na(e);return t&&t.length||(t=[[Ie(Aa)]]),t.forEach((function(e){e.forEach((function(e){return e.key||(e.key=ot.getUUID()),e}))})),{type:null,conditionRef:null,computedPickerVisible:!1,positionVisible:!1,form:{conditions:t},cloneConditions:Ie(e)}},computed:{selectOptions:function(){return this.fields.map((function(e){var t=e.fieldKey,i=e.fieldName;return{label:i||"",value:t}}))},originalTypes:function(){return this.fields.reduce((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.fieldKey,n=t.fieldType;return e[i]=n,e}),{})},fieldTypes:function(){return this.fields.reduce((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.fieldKey,n=t.fieldType;return e[i]=Ne[n],e}),{})},fieldNames:function(){return this.fields.reduce((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.fieldKey,n=t.fieldName;return e[i]=n,e}),{})},fieldOptions:function(){function e(e){return e===he.COMBO||e===he.RADIO}return this.fields.reduce((function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i.fieldKey,o=i.fieldType,a=i.fieldOptions;return e(o)&&a&&a.length&&(t[n]=a),t}),{})},computedPickerTitle:function(){return"请选择"+fe[this.type]},computedPickerValue:function(){var e=this;return this.conditionRef&&"object"===Object(h["a"])(this.conditionRef)&&Array.isArray(this.conditionRef.value)?this.conditionRef.value.map((function(t){var i=t.name,n=t.sysNo,o=t.nodeType;return{sysNo:n,nodeName:i,nodeType:o,key:e.isSubmitterPicker?"".concat(n,"-").concat(ue[e.type||"user"]):e.isTabTreePicker?"".concat(e.type,"-").concat(n,"-").concat(o||ga(e.type)):""}})):[]},computedPositionPickerValue:function(){return this.conditionRef&&"object"===Object(h["a"])(this.conditionRef)&&Array.isArray(this.conditionRef.value)?this.conditionRef.value.map((function(e){var t=e.name,i=e.sysNo;return{positionName:t,sysNo:i,key:i}})):[]},computedConditions:function(){return oa(this.form.conditions)},isSubmitterPicker:function(){return this.type===de.USER||this.type===de.DEPARTMENT||this.type===de.DEPARTMENT||this.type===de.POSITION_LABEL},isSubmitterPickerVisible:{get:function(){return this.isSubmitterPicker&&this.computedPickerVisible},set:function(e){return e||(this.type=null,this.computedPickerVisible=!1),e}},isTabTreePicker:function(){return this.type===de.PROJECT||this.type===de.COMPANY},isTabTreePickerVisible:{get:function(){return this.isTabTreePicker&&this.computedPickerVisible},set:function(e){return e||(this.type=null,this.computedPickerVisible=!1),e}}},created:function(){this.AND=tt,this.OR=it,this.LOGIC_SIGNS=nt,this.OrgNodeType=n},methods:{getValue:function(e){return this.node&&this.node.props&&void 0!==this.node.props[e]?Ie(this.node.props[e]):[Ie(Aa)]},getConditionTypes:function(e){var t=this.fieldTypes[e.fieldKey],i=ge[e.conditionCode];return t&&e.conditionCode!==t&&(e.conditionCode=t,i=ge[e.conditionCode],e.conditionType&&!i[e.conditionType]&&(e.conditionType=""),e.value&&(e.value="")),i},getPickerType:function(e){return e.fieldKey?pe[this.originalTypes[e.fieldKey]]:""},isPosition:function(e){return!!e&&e.fieldKey===wt},isMultipleType:function(e){return e&&e.conditionType&&(e.conditionType===Te.EQUAL_ANY_ONE||e.conditionType===Te.NE_ANY_ONE)},handleConditionPickerRef:function(e,t){this.conditionValPickerRefMap||(this.conditionValPickerRefMap=new WeakMap),t?this.conditionValPickerRefMap.has(e)&&this.conditionValPickerRefMap.get(e)===t||this.conditionValPickerRefMap.set(e,t):this.conditionValPickerRefMap.delete(e)},handleConditionTypeChange:function(e,t){if(!this.isMultipleType({conditionType:t})&&Array.isArray(e.value)&&e.value.length>1&&(e.value=e.value.slice(0,1)),this.conditionValPickerRefMap&&this.conditionValPickerRefMap.has(e)){var i=this.conditionValPickerRefMap.get(e);i&&i.resetInputHeight()}},handleConitionValueChange:function(e,t){Array.isArray(t)?e.value=t:e.value=[t]},getFieldOptions:function(e){return this.getPickerType(e)||this.isPosition(e)?(e.value||[]).map((function(e){var t=e.name,i=e.parentFullName;return"".concat(t).concat(i?"("+i+")":"")})).join("、"):this.fieldOptions[e.fieldKey]},handleUpdate:function(e){this.node&&this.node.update(e)},handleUpdateProps:function(e){this.node&&this.node.updateProps("string"!==typeof e?e:Object(b["a"])({},e,this[e]))},handleAddCondition:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.form.conditions[e].push(Object(p["a"])(Object(p["a"])(Object(p["a"])({},Aa),t),{},{key:ot.getUUID()}))},handleAddConditionGroup:function(e){this.form.conditions.push([Object(p["a"])(Object(p["a"])(Object(p["a"])({},Aa),e),{},{key:ot.getUUID()})])},handleRemoveCondition:function(e,t){var i=this.form.conditions[e];i.splice(t,1),i.length||this.handleRemoveConditionGroup(e),this.checkConditionSymbol()},handleRemoveConditionGroup:function(e){this.form.conditions.splice(e,1),this.checkConditionSymbol()},checkConditionSymbol:function(){var e=this.form.conditions[0],t=e&&e[0];null!==t.unionLogic&&(t.unionLogic=null)},getGroupLogicSymbol:function(e){var t=(this.form.conditions||[])[e]||[],i=t[0];return i&&i.unionLogic?i.unionLogic:null},handleClickConfirm:function(){var e=this,t=this.computedConditions;this.submitForm((function(){try{oi(t),e.handleUpdateProps({conditions:t.filter((function(e){var t=e.conditionCode,i=e.conditionType,n=e.fieldKey,o=e.value;return t&&i&&n&&o}))}),e.node&&e.node.read({conditions:t,fields:e.fields}),e.calcUsingConditionNumber(),e.$emit("update:visible",!1)}catch(i){e.$message.warning(i.message),console.error(i)}}))},calcUsingConditionNumber:function(){var e=this,t=this.cloneConditions.map((function(e){return e.fieldKey})),i=this.computedConditions.map((function(e){return e.fieldKey}));t.forEach((function(t){e.usingConditionFields[t]--})),i.forEach((function(t){Reflect.has(e.usingConditionFields,t)?e.usingConditionFields[t]++:e.$set(e.usingConditionFields,t,1)})),Object.keys(this.usingConditionFields).forEach((function(t){0===e.usingConditionFields[t]&&Reflect.deleteProperty(e.usingConditionFields,t)}))},handleClickCancel:function(){this.$emit("update:visible",!1)},handleClickPickerInput:function(e){this.conditionRef=e,e.fieldKey===wt?this.positionVisible=!0:(this.type=this.getPickerType(e),this.computedPickerVisible=!0)},handleConfirmPicker:function(e){this.conditionRef&&(this.conditionRef.value=e.map((function(e){var t=e.sysNo,i=e.nodeName,n=e.nodeType;return{name:i,sysNo:t,nodeType:n,level:Pa(n)}})))},handleCallBack:function(e){this.conditionRef&&(this.conditionRef.value=e.map((function(e){return{name:"".concat(e.positionName).concat(e.parentFullName?"("+e.parentFullName+")":""),sysNo:e.sysNo}})))},submitForm:function(e,t){this.$refs["conditionsForm"].validate((function(i){if(!i)return t&&t(),!1;e&&e()}))},resetForm:function(){this.$refs["conditionsForm"].resetFields()},handleChange:function(e){e.value=""}}},Sa=Ra,ka=(i("3d60"),Object(yi["a"])(Sa,ta,ia,!1,null,"f908b5ce",null)),Ca=ka.exports,ja={name:"DesignCenter",components:{SidePanel:jn,FlowLayout:ea,ConditionSettings:Ca},data:function(){return{currNode:null,conditionVisible:!1,projectSysNo:this.$route&&this.$route.params.projectSysNo,dirty:!1,startNode:null,isDev:!1,usingConditionFields:{},flowForm:{},flowModel:{},flowSponsors:{},flowSettings:{},currentOrganization:{},corpSysNo:""}},computed:{formFields:function(){var e=(this.flowForm||{}).formContentObject||{},t=e.fields||[];return t&&t.length?t:[]},flowFields:function(){var e=this;return this.formFields.map((function(t){var i=t.name,n=t.type,o=t.key,a=t.options,r=a.required,s=a.editable,l=a.textVisible,c=!1,d=!!e.usingConditionFields[o];return l&&1===e.joinPlan&&(c=Pt(n)),{type:n,fieldKey:o,fieldName:i,canView:l,canWrite:c,require:r||!1,editable:s,textVisible:l||!1,useCondition:d}}))},joinPlan:function(){return this.isBusinessFlow&&this.flowForm&&this.flowForm.joinPlan||1},isBusinessFlow:function(){return this.flowSettings&&this.flowSettings.flowType===gi},conditionFields:function(){return Object.keys(Dt).map((function(e){return{fieldKey:e,fieldName:Dt[e],fieldType:Ft[e],fieldOptions:[]}})).concat(this.formFields.filter((function(e){var t=e.type,i=e.options,n=i.multiple,o=i.required,a=Ne[t];return Oe[t]?o&&!n:o&&!!a})).map((function(e){var t=e.type,i=e.key,n=e.name,o=e.options.options;return{fieldKey:i,fieldName:n,fieldType:t,fieldOptions:o||[]}})))},flowCode:function(){return this.$route.query&&this.$route.query.flowCode},isReady:function(){return!!this.startNode},visible:{get:function(){return this.currNode&&this.currNode.type!==ot.TYPE.CONDITION_NODE&&Boolean(this.currNode)},set:function(e){if(!e&&this.currNode)return this.currNode=null,this.$refs.panel.activeName="node",!1}}},watch:{conditionVisible:function(e){!e&&this.currNode&&(this.currNode=null)},flowModel:function(e,t){var i=t&&"object"===Object(h["a"])(t)&&Boolean(Object.keys(t).length);i||t===e||(e&&this.getUsingConditionFields(),e&&this.initViewModel())},flowSponsors:function(e){e&&this.startNode&&this.startNode.read(this.flowSponsors)},flowSettings:function(){this.updateStartNode()},flowFields:function(e,t){Array.isArray(e)&&Array.isArray(t)&&e.length!==t.length&&this.updateFieldsList()},startNode:{deep:!0,handler:function(e,t){e&&t&&e===t&&(this.dirty=!0),this.updateStartNode()}},usingConditionFields:{deep:!0,handler:function(){this.updateFieldsWritable()}}},created:function(){this.listenEvent(),this.getUsingConditionFields(),this.initViewModel()},beforeRouteLeave:function(e,t,i){if(this.$root&&this.$root.$off("wf-save"),this.$root&&this.$root.$off("wf-release"),this.visible&&(this.visible=!1),this.dirty)try{var n=!0;this.$store.commit("workFlow/setDesignProcess",this.geneFlowModel(n))}catch(o){0,this.$message({message:o.message||o,type:"warning"})}i()},destroyed:function(){y.clear()},methods:{getUsingConditionFields:function(){var e=this,t=Object.keys(Dt),i=((this.flowModel||{}).sequenceList||[]).map((function(e){return e.conditionList})).filter((function(e){return e&&e.length})),n=[];i.forEach((function(e){return n.push.apply(n,Object(f["a"])(e))}));var o=(n||[]).map((function(e){return e.fieldKey})).filter((function(e){return!t.includes(e)}));o.forEach((function(t){Reflect.has(e.usingConditionFields,t)||e.$set(e.usingConditionFields,t,o.filter((function(e){return e===t})).length)}))},listenEvent:function(){this.$root&&this.$root.$on("wf-save",this.handleSave),this.$root&&this.$root.$on("wf-release",this.handleRelease)},initViewModel:function(){this.startNode=Bt(this.flowModel||{},{conditionFields:this.conditionFields,flowFields:this.flowFields},this.isBusinessFlow),this.startNode&&this.flowFields&&this.flowFields.length&&this.updateFieldsList()},updateStartNode:function(){var e=this.startNode&&this.startNode.read(),t=this.flowSettings,i=this.flowSponsors||t&&t.applyScope&&t.applyScope.applyScopeName;!this.startNode||e&&e===i||this.startNode.read(i)},updateFieldsList:function(){var e=this,t=this.startNode&&this.startNode.props,i=t&&t.formFieldList;i&&i.length&&this.flowFields.length===i.length||(Qe(this.startNode,(function(t){t.updateProps({formFieldList:_t(e.flowFields.map((function(t){return Object(p["a"])(Object(p["a"])({},t),{},{canWrite:!e.usingConditionFields[t.fieldKey]&&1===e.joinPlan})})),t.formFieldList,t.alias||t.type)})})),this.handleUpdateNode(this.startNode))},updateFieldsWritable:function(){var e=this;Qe(this.startNode,(function(t){t.type!==ot.TYPE.SPONSOR_NODE&&((t.props.formFieldList||[]).forEach((function(t){e.usingConditionFields[t.fieldKey]&&(t.canWrite=!1)})),t.updateProps({formFieldList:t.props.formFieldList}))}))},geneFlowModel:function(e){var t=ai(this.startNode,e),i=this.flowSettings||{},n=i.flowCode,o=void 0===n?"":n,a=i.flowName,r=void 0===a?"":a,s=Object(p["a"])(Object(p["a"])({},this.flowModel),{},{flowCode:o,flowName:r},t);return console.log("flowModel: ",s),s},handleSave:function(e){try{e?this.dirty&&this.geneFlowModel(e):this.$store.dispatch("workFlow/saveDesignProcess",this.dirty&&this.geneFlowModel(!0))}catch(t){0,this.$message({message:t.message||t,type:"warning"})}},handleRelease:function(){var e=this;try{this.$store.commit("workFlow/setDesignProcess",this.geneFlowModel())}catch(t){return this.$message({message:t.message||t,type:"warning"})}this.$store.dispatch("workFlow/publishFlow").then((function(t){e.$router.push({path:t})}))},handleClickNode:function(e){this.currNode=e,e.type===ot.TYPE.CONDITION_NODE?this.conditionVisible=!0:this.visible=!0},handleUpdateNode:function(e){var t=e||y.getNode(this.startNode),i=t.props,n=Object(u["a"])(t,["props"]);this.startNode=Re.createNode(Object(p["a"])(Object(p["a"])({},n),i)),this.dirty=!0}}},La=ja,wa=Object(yi["a"])(La,c,d,!1,null,null,null),Da=wa.exports,Fa={name:"App",components:{DesignCenter:Da}},Ba=Fa,xa=(i("5c0b"),Object(yi["a"])(Ba,s,l,!1,null,null,null)),Va=xa.exports;o["default"].config.productionTip=!1,new o["default"]({render:function(e){return e(Va)}}).$mount("#app")},"5c0b":function(e,t,i){"use strict";i("9c0c")},"8e62":function(e,t,i){},"9c0c":function(e,t,i){},bb1d:function(e,t,i){"use strict";i("4c2a")},c97c:function(e,t,i){},e4c4:function(e,t,i){},ebf5:function(e,t,i){},fadd:function(e,t,i){"use strict";i("ebf5")},fd74:function(e,t,i){"use strict";i("1402")}});
//# sourceMappingURL=app.3153b709.js.map